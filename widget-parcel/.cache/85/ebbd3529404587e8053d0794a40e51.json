{"id":"JQOA","dependencies":[{"name":"C:\\Users\\king1\\Documents\\GitHub\\react-widget\\widget-parcel\\package.json","includedInParent":true,"mtime":1625202366836},{"name":"C:\\Users\\king1\\Documents\\GitHub\\react-widget\\widget-parcel\\node_modules\\@firebase\\firestore\\package.json","includedInParent":true,"mtime":1625202365926},{"name":"tslib","loc":{"line":1,"column":85},"parent":"C:\\Users\\king1\\Documents\\GitHub\\react-widget\\widget-parcel\\node_modules\\@firebase\\firestore\\dist\\esm5\\prebuilt-038c95ef-26ab9a06.js","resolved":"C:\\Users\\king1\\Documents\\GitHub\\react-widget\\widget-parcel\\node_modules\\tslib\\tslib.es6.js"},{"name":"@firebase/util","loc":{"line":3,"column":185},"parent":"C:\\Users\\king1\\Documents\\GitHub\\react-widget\\widget-parcel\\node_modules\\@firebase\\firestore\\dist\\esm5\\prebuilt-038c95ef-26ab9a06.js","resolved":"C:\\Users\\king1\\Documents\\GitHub\\react-widget\\widget-parcel\\node_modules\\@firebase\\util\\dist\\index.esm.js"},{"name":"@firebase/logger","loc":{"line":5,"column":43},"parent":"C:\\Users\\king1\\Documents\\GitHub\\react-widget\\widget-parcel\\node_modules\\@firebase\\firestore\\dist\\esm5\\prebuilt-038c95ef-26ab9a06.js","resolved":"C:\\Users\\king1\\Documents\\GitHub\\react-widget\\widget-parcel\\node_modules\\@firebase\\logger\\dist\\index.esm.js"},{"name":"@firebase/webchannel-wrapper","loc":{"line":7,"column":182},"parent":"C:\\Users\\king1\\Documents\\GitHub\\react-widget\\widget-parcel\\node_modules\\@firebase\\firestore\\dist\\esm5\\prebuilt-038c95ef-26ab9a06.js","resolved":"C:\\Users\\king1\\Documents\\GitHub\\react-widget\\widget-parcel\\node_modules\\@firebase\\webchannel-wrapper\\dist\\index.esm.js"},{"name":"process","parent":"C:\\Users\\king1\\Documents\\GitHub\\react-widget\\widget-parcel\\node_modules\\@firebase\\firestore\\dist\\esm5\\prebuilt-038c95ef-26ab9a06.js","resolved":"C:\\Users\\king1\\AppData\\Roaming\\npm\\node_modules\\parcel-bundler\\node_modules\\process\\browser.js"}],"generated":{"js":"var process = require(\"process\");\nvar t=require(\"process\");Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.K=ac,exports.c=Sc,exports.o=Tc,exports.r=exports.q=exports.p=exports.n=exports.j=exports.i=exports.e=exports.a=exports.Z=exports.Y=exports.X=exports.Q=exports.O=exports.G=exports.E=exports.D=exports.B=void 0;var e=require(\"tslib\"),n=require(\"@firebase/util\"),r=require(\"@firebase/logger\"),i=require(\"@firebase/webchannel-wrapper\");function o(t){return(o=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t})(t)}var s=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();s.o=-1;var a={OK:\"ok\",CANCELLED:\"cancelled\",UNKNOWN:\"unknown\",INVALID_ARGUMENT:\"invalid-argument\",DEADLINE_EXCEEDED:\"deadline-exceeded\",NOT_FOUND:\"not-found\",ALREADY_EXISTS:\"already-exists\",PERMISSION_DENIED:\"permission-denied\",UNAUTHENTICATED:\"unauthenticated\",RESOURCE_EXHAUSTED:\"resource-exhausted\",FAILED_PRECONDITION:\"failed-precondition\",ABORTED:\"aborted\",OUT_OF_RANGE:\"out-of-range\",UNIMPLEMENTED:\"unimplemented\",INTERNAL:\"internal\",UNAVAILABLE:\"unavailable\",DATA_LOSS:\"data-loss\"},u=function(t){function n(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name=\"FirebaseError\",r.toString=function(){return r.name+\": [code=\"+r.code+\"]: \"+r.message},r}return(0,e.__extends)(n,t),n}(Error),c=new r.Logger(\"@firebase/firestore\");function h(){return c.logLevel}function f(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];if(c.logLevel<=r.LogLevel.DEBUG){var o=n.map(p);c.debug.apply(c,(0,e.__spreadArray)([\"Firestore (8.7.0): \"+t],o))}}function l(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];if(c.logLevel<=r.LogLevel.ERROR){var o=n.map(p);c.error.apply(c,(0,e.__spreadArray)([\"Firestore (8.7.0): \"+t],o))}}function d(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];if(c.logLevel<=r.LogLevel.WARN){var o=n.map(p);c.warn.apply(c,(0,e.__spreadArray)([\"Firestore (8.7.0): \"+t],o))}}function p(t){if(\"string\"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function y(t){void 0===t&&(t=\"Unexpected state\");var e=\"FIRESTORE (8.7.0) INTERNAL ASSERTION FAILED: \"+t;throw l(e),new Error(e)}function v(t,e){t||y()}function m(t,e){return t}function g(t){var e=\"undefined\"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&\"function\"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var _=function(){function t(){}return t.u=function(){for(var t=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\",e=Math.floor(256/t.length)*t.length,n=\"\";n.length<20;)for(var r=g(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function w(t,e){return t<e?-1:t>e?1:0}function b(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function I(t){return t+\"\\0\"}var E=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new u(a.INVALID_ARGUMENT,\"Timestamp nanoseconds out of range: \"+e);if(e>=1e9)throw new u(a.INVALID_ARGUMENT,\"Timestamp nanoseconds out of range: \"+e);if(t<-62135596800)throw new u(a.INVALID_ARGUMENT,\"Timestamp seconds out of range: \"+t);if(t>=253402300800)throw new u(a.INVALID_ARGUMENT,\"Timestamp seconds out of range: \"+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?w(this.nanoseconds,t.nanoseconds):w(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return\"Timestamp(seconds=\"+this.seconds+\", nanoseconds=\"+this.nanoseconds+\")\"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,\"0\")+\".\"+String(this.nanoseconds).padStart(9,\"0\")},t}(),T=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new E(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return\"SnapshotVersion(\"+this.timestamp.toString()+\")\"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function S(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function N(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function D(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}exports.O=E;var A=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&y(),void 0===n?n=t.length-e:n>t.length-e&&y(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,\"length\",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),x=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n.prototype.construct=function(t,e,r){return new n(t,e,r)},n.prototype.canonicalString=function(){return this.toArray().join(\"/\")},n.prototype.toString=function(){return this.canonicalString()},n.fromString=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf(\"//\")>=0)throw new u(a.INVALID_ARGUMENT,\"Invalid segment (\"+s+\"). Paths must not contain // in them.\");r.push.apply(r,s.split(\"/\").filter(function(t){return t.length>0}))}return new n(r)},n.emptyPath=function(){return new n([])},n}(A),k=/^[_a-zA-Z][_a-zA-Z0-9]*$/,C=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n.prototype.construct=function(t,e,r){return new n(t,e,r)},n.isValidIdentifier=function(t){return k.test(t)},n.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\\\/g,\"\\\\\\\\\").replace(/`/g,\"\\\\`\"),n.isValidIdentifier(t)||(t=\"`\"+t+\"`\"),t}).join(\".\")},n.prototype.toString=function(){return this.canonicalString()},n.prototype.isKeyField=function(){return 1===this.length&&\"__name__\"===this.get(0)},n.keyField=function(){return new n([\"__name__\"])},n.fromServerFormat=function(t){for(var e=[],r=\"\",i=0,o=function(){if(0===r.length)throw new u(a.INVALID_ARGUMENT,\"Invalid field path (\"+t+\"). Paths must not be empty, begin with '.', end with '.', or contain '..'\");e.push(r),r=\"\"},s=!1;i<t.length;){var c=t[i];if(\"\\\\\"===c){if(i+1===t.length)throw new u(a.INVALID_ARGUMENT,\"Path has trailing escape character: \"+t);var h=t[i+1];if(\"\\\\\"!==h&&\".\"!==h&&\"`\"!==h)throw new u(a.INVALID_ARGUMENT,\"Path has invalid escape sequence: \"+t);r+=h,i+=2}else\"`\"===c?(s=!s,i++):\".\"!==c||s?(r+=c,i++):(o(),i++)}if(o(),s)throw new u(a.INVALID_ARGUMENT,\"Unterminated ` in path: \"+t);return new n(e)},n.emptyPath=function(){return new n([])},n}(A),R=function(){function t(t){this.fields=t,t.sort(C.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return b(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),L=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e=\"\",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return w(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();L.EMPTY_BYTE_STRING=new L(\"\");var O=new RegExp(/^\\d{4}-\\d\\d-\\d\\dT\\d\\d:\\d\\d:\\d\\d(?:\\.(\\d+))?Z$/);function P(t){if(v(!!t),\"string\"==typeof t){var e=0,n=O.exec(t);if(v(!!n),n[1]){var r=n[1];r=(r+\"000000000\").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:M(t.seconds),nanos:M(t.nanos)}}function M(t){return\"number\"==typeof t?t:\"string\"==typeof t?Number(t):0}function F(t){return\"string\"==typeof t?L.fromBase64String(t):L.fromUint8Array(t)}function V(t){var e,n;return\"server_timestamp\"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function q(t){var e=t.mapValue.fields.__previous_value__;return V(e)?q(e):e}function U(t){var e=P(t.mapValue.fields.__local_write_time__.timestampValue);return new E(e.seconds,e.nanos)}function B(t){return null==t}function j(t){return 0===t&&1/t==-1/0}function K(t){return\"number\"==typeof t&&Number.isInteger(t)&&!j(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Q=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(x.fromString(e))},t.fromName=function(e){return new t(x.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===x.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return x.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new x(e.slice()))},t}();function G(t){return\"nullValue\"in t?0:\"booleanValue\"in t?1:\"integerValue\"in t||\"doubleValue\"in t?2:\"timestampValue\"in t?3:\"stringValue\"in t?5:\"bytesValue\"in t?6:\"referenceValue\"in t?7:\"geoPointValue\"in t?8:\"arrayValue\"in t?9:\"mapValue\"in t?V(t)?4:10:y()}function z(t,e){var n=G(t);if(n!==G(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return U(t).isEqual(U(e));case 3:return function(t,e){if(\"string\"==typeof t.timestampValue&&\"string\"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=P(t.timestampValue),r=P(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return F(t.bytesValue).isEqual(F(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return M(t.geoPointValue.latitude)===M(e.geoPointValue.latitude)&&M(t.geoPointValue.longitude)===M(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if(\"integerValue\"in t&&\"integerValue\"in e)return M(t.integerValue)===M(e.integerValue);if(\"doubleValue\"in t&&\"doubleValue\"in e){var n=M(t.doubleValue),r=M(e.doubleValue);return n===r?j(n)===j(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return b(t.arrayValue.values||[],e.arrayValue.values||[],z);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(S(n)!==S(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!z(n[i],r[i])))return!1;return!0}(t,e);default:return y()}}function W(t,e){return void 0!==(t.values||[]).find(function(t){return z(t,e)})}function H(t,e){var n=G(t),r=G(e);if(n!==r)return w(n,r);switch(n){case 0:return 0;case 1:return w(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=M(t.integerValue||t.doubleValue),r=M(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Y(t.timestampValue,e.timestampValue);case 4:return Y(U(t),U(e));case 5:return w(t.stringValue,e.stringValue);case 6:return function(t,e){var n=F(t),r=F(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split(\"/\"),r=e.split(\"/\"),i=0;i<n.length&&i<r.length;i++){var o=w(n[i],r[i]);if(0!==o)return o}return w(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=w(M(t.latitude),M(e.latitude));return 0!==n?n:w(M(t.longitude),M(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=H(n[i],r[i]);if(o)return o}return w(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=w(r[s],o[s]);if(0!==a)return a;var u=H(n[r[s]],i[o[s]]);if(0!==u)return u}return w(r.length,o.length)}(t.mapValue,e.mapValue);default:throw y()}}function Y(t,e){if(\"string\"==typeof t&&\"string\"==typeof e&&t.length===e.length)return w(t,e);var n=P(t),r=P(e),i=w(n.seconds,r.seconds);return 0!==i?i:w(n.nanos,r.nanos)}function $(t){return X(t)}function X(t){return\"nullValue\"in t?\"null\":\"booleanValue\"in t?\"\"+t.booleanValue:\"integerValue\"in t?\"\"+t.integerValue:\"doubleValue\"in t?\"\"+t.doubleValue:\"timestampValue\"in t?function(t){var e=P(t);return\"time(\"+e.seconds+\",\"+e.nanos+\")\"}(t.timestampValue):\"stringValue\"in t?t.stringValue:\"bytesValue\"in t?F(t.bytesValue).toBase64():\"referenceValue\"in t?(n=t.referenceValue,Q.fromName(n).toString()):\"geoPointValue\"in t?\"geo(\"+(e=t.geoPointValue).latitude+\",\"+e.longitude+\")\":\"arrayValue\"in t?function(t){for(var e=\"[\",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=\",\",e+=X(i[r]);return e+\"]\"}(t.arrayValue):\"mapValue\"in t?function(t){for(var e=\"{\",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=\",\",e+=o+\":\"+X(t.fields[o])}return e+\"}\"}(t.mapValue):y();var e,n}function J(t,e){return{referenceValue:\"projects/\"+t.projectId+\"/databases/\"+t.database+\"/documents/\"+e.path.canonicalString()}}function Z(t){return!!t&&\"integerValue\"in t}function tt(t){return!!t&&\"arrayValue\"in t}function et(t){return!!t&&\"nullValue\"in t}function nt(t){return!!t&&\"doubleValue\"in t&&isNaN(Number(t.doubleValue))}function rt(t){return!!t&&\"mapValue\"in t}function it(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue)return{timestampValue:Object.assign({},P(t.timestampValue))};if(t.mapValue){var e={mapValue:{fields:{}}};return N(t.mapValue.fields,function(t,n){return e.mapValue.fields[t]=it(n)}),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=it(t.arrayValue.values[r]);return n}return Object.assign({},t)}var ot=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!rt(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=it(e)},t.prototype.setAll=function(t){var e=this,n=C.emptyPath(),r={},i=[];t.forEach(function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=it(t):i.push(o.lastSegment())});var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());rt(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return z(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];rt(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){N(e,function(e,n){return t[e]=n});for(var r=0,i=n;r<i.length;r++){var o=i[r];delete t[o]}},t.prototype.clone=function(){return new t(it(this.value))},t}();function st(t){var e=[];return N(t.fields,function(t,n){var r=new C([t]);if(rt(n)){var i=st(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var a=s[o];e.push(r.child(a))}}else e.push(r)}),new R(e)}var at=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,T.min(),ot.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,ot.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,ot.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=ot.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=ot.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,\"hasLocalMutations\",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"hasCommittedMutations\",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"hasPendingWrites\",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return\"Document(\"+this.key+\", \"+this.version+\", \"+JSON.stringify(this.data.value)+\", {documentType: \"+this.documentType+\"}), {documentState: \"+this.documentState+\"})\"},t}(),ut=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function ct(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new ut(t,e,n,r,i,o,s)}function ht(t){var e=m(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+=\"|cg:\"+e.collectionGroup),n+=\"|f:\",n+=e.filters.map(function(t){return function(t){return t.field.canonicalString()+t.op.toString()+$(t.value)}(t)}).join(\",\"),n+=\"|ob:\",n+=e.orderBy.map(function(t){return function(t){return t.field.canonicalString()+t.dir}(t)}).join(\",\"),B(e.limit)||(n+=\"|l:\",n+=e.limit),e.startAt&&(n+=\"|lb:\",n+=Et(e.startAt)),e.endAt&&(n+=\"|ub:\",n+=Et(e.endAt)),e.h=n}return e.h}function ft(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!St(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!z(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Dt(t.startAt,e.startAt)&&Dt(t.endAt,e.endAt)}function lt(t){return Q.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var dt=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return(0,e.__extends)(n,t),n.create=function(t,e,r){return t.isKeyField()?\"in\"===e||\"not-in\"===e?this.l(t,e,r):new pt(t,e,r):\"array-contains\"===e?new gt(t,r):\"in\"===e?new _t(t,r):\"not-in\"===e?new wt(t,r):\"array-contains-any\"===e?new bt(t,r):new n(t,e,r)},n.l=function(t,e,n){return\"in\"===e?new yt(t,n):new vt(t,n)},n.prototype.matches=function(t){var e=t.data.field(this.field);return\"!=\"===this.op?null!==e&&this.m(H(e,this.value)):null!==e&&G(this.value)===G(e)&&this.m(H(e,this.value))},n.prototype.m=function(t){switch(this.op){case\"<\":return t<0;case\"<=\":return t<=0;case\"==\":return 0===t;case\"!=\":return 0!==t;case\">\":return t>0;case\">=\":return t>=0;default:return y()}},n.prototype.g=function(){return[\"<\",\"<=\",\">\",\">=\",\"!=\",\"not-in\"].indexOf(this.op)>=0},n}(function(){}),pt=function(t){function n(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=Q.fromName(r.referenceValue),i}return(0,e.__extends)(n,t),n.prototype.matches=function(t){var e=Q.comparator(t.key,this.key);return this.m(e)},n}(dt),yt=function(t){function n(e,n){var r=this;return(r=t.call(this,e,\"in\",n)||this).keys=mt(\"in\",n),r}return(0,e.__extends)(n,t),n.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},n}(dt),vt=function(t){function n(e,n){var r=this;return(r=t.call(this,e,\"not-in\",n)||this).keys=mt(\"not-in\",n),r}return(0,e.__extends)(n,t),n.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},n}(dt);function mt(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return Q.fromName(t.referenceValue)})}var gt=function(t){function n(e,n){return t.call(this,e,\"array-contains\",n)||this}return(0,e.__extends)(n,t),n.prototype.matches=function(t){var e=t.data.field(this.field);return tt(e)&&W(e.arrayValue,this.value)},n}(dt),_t=function(t){function n(e,n){return t.call(this,e,\"in\",n)||this}return(0,e.__extends)(n,t),n.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&W(this.value.arrayValue,e)},n}(dt),wt=function(t){function n(e,n){return t.call(this,e,\"not-in\",n)||this}return(0,e.__extends)(n,t),n.prototype.matches=function(t){if(W(this.value.arrayValue,{nullValue:\"NULL_VALUE\"}))return!1;var e=t.data.field(this.field);return null!==e&&!W(this.value.arrayValue,e)},n}(dt),bt=function(t){function n(e,n){return t.call(this,e,\"array-contains-any\",n)||this}return(0,e.__extends)(n,t),n.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!tt(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return W(e.value.arrayValue,t)})},n}(dt),It=function(t,e){this.position=t,this.before=e};function Et(t){return(t.before?\"b\":\"a\")+\":\"+t.position.map(function(t){return $(t)}).join(\",\")}var Tt=function(t,e){void 0===e&&(e=\"asc\"),this.field=t,this.dir=e};function St(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Nt(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?Q.comparator(Q.fromName(s.referenceValue),n.key):H(s,n.data.field(o.field)),\"desc\"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Dt(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!z(t.position[n],e.position[n]))return!1;return!0}var At=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=\"F\"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function xt(t,e,n,r,i,o,s,a){return new At(t,e,n,r,i,o,s,a)}function kt(t){return new At(t)}function Ct(t){return!B(t.limit)&&\"F\"===t.limitType}function Rt(t){return!B(t.limit)&&\"L\"===t.limitType}function Lt(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Ot(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Pt(t){return null!==t.collectionGroup}function Mt(t){var e=m(t);if(null===e.p){e.p=[];var n=Ot(e),r=Lt(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new Tt(n)),e.p.push(new Tt(C.keyField(),\"asc\"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:\"asc\";e.p.push(new Tt(C.keyField(),u))}}}return e.p}function Ft(t){var e=m(t);if(!e.T)if(\"F\"===e.limitType)e.T=ct(e.path,e.collectionGroup,Mt(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Mt(e);r<i.length;r++){var o=i[r],s=\"desc\"===o.dir?\"asc\":\"desc\";n.push(new Tt(o.field,s))}var a=e.endAt?new It(e.endAt.position,!e.endAt.before):null,u=e.startAt?new It(e.startAt.position,!e.startAt.before):null;e.T=ct(e.path,e.collectionGroup,n,e.filters,e.limit,a,u)}return e.T}function Vt(t,e,n){return new At(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function qt(t,e){return ft(Ft(t),Ft(e))&&t.limitType===e.limitType}function Ut(t){return ht(Ft(t))+\"|lt:\"+t.limitType}function Bt(t){return\"Query(target=\"+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=\" collectionGroup=\"+t.collectionGroup),t.filters.length>0&&(e+=\", filters: [\"+t.filters.map(function(t){return(e=t).field.canonicalString()+\" \"+e.op+\" \"+$(e.value);var e}).join(\", \")+\"]\"),B(t.limit)||(e+=\", limit: \"+t.limit),t.orderBy.length>0&&(e+=\", orderBy: [\"+t.orderBy.map(function(t){return function(t){return t.field.canonicalString()+\" (\"+t.dir+\")\"}(t)}).join(\", \")+\"]\"),t.startAt&&(e+=\", startAt: \"+Et(t.startAt)),t.endAt&&(e+=\", endAt: \"+Et(t.endAt)),\"Target(\"+e+\")\"}(Ft(t))+\"; limitType=\"+t.limitType+\")\"}function jt(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Q.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Nt(t.startAt,Mt(t),e)||t.endAt&&Nt(t.endAt,Mt(t),e))}(t,e)}function Kt(t){return function(e,n){for(var r=!1,i=0,o=Mt(t);i<o.length;i++){var s=o[i],a=Qt(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function Qt(t,e,n){var r=t.field.isKeyField()?Q.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?H(r,i):y()}(t.field,e,n);switch(t.dir){case\"asc\":return r;case\"desc\":return-1*r;default:return y()}}function Gt(t,e){if(t.I){if(isNaN(e))return{doubleValue:\"NaN\"};if(e===1/0)return{doubleValue:\"Infinity\"};if(e===-1/0)return{doubleValue:\"-Infinity\"}}return{doubleValue:j(e)?\"-0\":e}}function zt(t){return{integerValue:\"\"+t}}function Wt(t,e){return K(e)?zt(e):Gt(t,e)}var Ht=function(){this._=void 0};function Yt(t,e,n){return t instanceof Jt?function(t,e){var n={fields:{__type__:{stringValue:\"server_timestamp\"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Zt?te(t,e):t instanceof ee?ne(t,e):function(t,e){var n=Xt(t,e),r=ie(n)+ie(t.A);return Z(n)&&Z(t.A)?zt(r):Gt(t.R,r)}(t,e)}function $t(t,e,n){return t instanceof Zt?te(t,e):t instanceof ee?ne(t,e):n}function Xt(t,e){return t instanceof re?Z(n=e)||n&&\"doubleValue\"in n?e:{integerValue:0}:null;var n}var Jt=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n}(Ht),Zt=function(t){function n(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,e.__extends)(n,t),n}(Ht);function te(t,e){for(var n=oe(e),r=function(t){n.some(function(e){return z(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ee=function(t){function n(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,e.__extends)(n,t),n}(Ht);function ne(t,e){for(var n=oe(e),r=function(t){n=n.filter(function(e){return!z(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var re=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return(0,e.__extends)(n,t),n}(Ht);function ie(t){return M(t.integerValue||t.doubleValue)}function oe(t){return tt(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var se=function(t,e){this.field=t,this.transform=e},ae=function(t,e){this.version=t,this.transformResults=e},ue=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,\"isNone\",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function ce(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var he=function(){};function fe(t,e,n){t instanceof ve?function(t,e,n){var r=t.value.clone(),i=_e(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof me?function(t,e,n){if(ce(t.precondition,e)){var r=_e(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(ge(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function le(t,e,n){t instanceof ve?function(t,e,n){if(ce(t.precondition,e)){var r=t.value.clone(),i=we(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(ye(e),r).setHasLocalMutations()}}(t,e,n):t instanceof me?function(t,e,n){if(ce(t.precondition,e)){var r=we(t.fieldTransforms,n,e),i=e.data;i.setAll(ge(t)),i.setAll(r),e.convertToFoundDocument(ye(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){ce(t.precondition,e)&&e.convertToNoDocument(T.min())}(t,e)}function de(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=Xt(o.transform,s||null);null!=a&&(null==n&&(n=ot.empty()),n.set(o.field,a))}return n||null}function pe(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&b(t,e,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Zt&&e instanceof Zt||t instanceof ee&&e instanceof ee?b(t.elements,e.elements,z):t instanceof re&&e instanceof re?z(t.A,e.A):t instanceof Jt&&e instanceof Jt}(t.transform,e.transform)}(t,e)})}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function ye(t){return t.isFoundDocument()?t.version:T.min()}var ve=function(t){function n(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return(0,e.__extends)(n,t),n}(he),me=function(t){function n(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return(0,e.__extends)(n,t),n}(he);function ge(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function _e(t,e,n){var r=new Map;v(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,$t(s,a,n[i]))}return r}function we(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,Yt(a,u,e))}return r}var be,Ie,Ee=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return(0,e.__extends)(n,t),n}(he),Te=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return(0,e.__extends)(n,t),n}(he),Se=function(t){this.count=t};function Ne(t){switch(t){case a.OK:return y();case a.CANCELLED:case a.UNKNOWN:case a.DEADLINE_EXCEEDED:case a.RESOURCE_EXHAUSTED:case a.INTERNAL:case a.UNAVAILABLE:case a.UNAUTHENTICATED:return!1;case a.INVALID_ARGUMENT:case a.NOT_FOUND:case a.ALREADY_EXISTS:case a.PERMISSION_DENIED:case a.FAILED_PRECONDITION:case a.ABORTED:case a.OUT_OF_RANGE:case a.UNIMPLEMENTED:case a.DATA_LOSS:return!0;default:return y()}}function De(t){if(void 0===t)return l(\"GRPC error has no .code\"),a.UNKNOWN;switch(t){case be.OK:return a.OK;case be.CANCELLED:return a.CANCELLED;case be.UNKNOWN:return a.UNKNOWN;case be.DEADLINE_EXCEEDED:return a.DEADLINE_EXCEEDED;case be.RESOURCE_EXHAUSTED:return a.RESOURCE_EXHAUSTED;case be.INTERNAL:return a.INTERNAL;case be.UNAVAILABLE:return a.UNAVAILABLE;case be.UNAUTHENTICATED:return a.UNAUTHENTICATED;case be.INVALID_ARGUMENT:return a.INVALID_ARGUMENT;case be.NOT_FOUND:return a.NOT_FOUND;case be.ALREADY_EXISTS:return a.ALREADY_EXISTS;case be.PERMISSION_DENIED:return a.PERMISSION_DENIED;case be.FAILED_PRECONDITION:return a.FAILED_PRECONDITION;case be.ABORTED:return a.ABORTED;case be.OUT_OF_RANGE:return a.OUT_OF_RANGE;case be.UNIMPLEMENTED:return a.UNIMPLEMENTED;case be.DATA_LOSS:return a.DATA_LOSS;default:return y()}}(Ie=be||(be={}))[Ie.OK=0]=\"OK\",Ie[Ie.CANCELLED=1]=\"CANCELLED\",Ie[Ie.UNKNOWN=2]=\"UNKNOWN\",Ie[Ie.INVALID_ARGUMENT=3]=\"INVALID_ARGUMENT\",Ie[Ie.DEADLINE_EXCEEDED=4]=\"DEADLINE_EXCEEDED\",Ie[Ie.NOT_FOUND=5]=\"NOT_FOUND\",Ie[Ie.ALREADY_EXISTS=6]=\"ALREADY_EXISTS\",Ie[Ie.PERMISSION_DENIED=7]=\"PERMISSION_DENIED\",Ie[Ie.UNAUTHENTICATED=16]=\"UNAUTHENTICATED\",Ie[Ie.RESOURCE_EXHAUSTED=8]=\"RESOURCE_EXHAUSTED\",Ie[Ie.FAILED_PRECONDITION=9]=\"FAILED_PRECONDITION\",Ie[Ie.ABORTED=10]=\"ABORTED\",Ie[Ie.OUT_OF_RANGE=11]=\"OUT_OF_RANGE\",Ie[Ie.UNIMPLEMENTED=12]=\"UNIMPLEMENTED\",Ie[Ie.INTERNAL=13]=\"INTERNAL\",Ie[Ie.UNAVAILABLE=14]=\"UNAVAILABLE\",Ie[Ie.DATA_LOSS=15]=\"DATA_LOSS\";var Ae=function(){function t(t,e){this.comparator=t,this.root=e||ke.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,ke.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ke.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,\"size\",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+\":\"+n),!1}),\"{\"+t.join(\", \")+\"}\"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new xe(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new xe(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new xe(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new xe(this.root,t,this.comparator,!0)},t}(),xe=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),ke=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw y();if(this.right.isRed())throw y();var t=this.left.check();if(t!==this.right.check())throw y();return t+(this.isRed()?0:1)},t}();ke.EMPTY=null,ke.RED=!0,ke.BLACK=!1,ke.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,\"key\",{get:function(){throw y()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"value\",{get:function(){throw y()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"color\",{get:function(){throw y()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"left\",{get:function(){throw y()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"right\",{get:function(){throw y()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new ke(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var Ce=function(){function t(t){this.comparator=t,this.data=new Ae(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,\"size\",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new Re(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new Re(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),\"SortedSet(\"+t.toString()+\")\"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Re=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Le=new Ae(Q.comparator);function Oe(){return Le}var Pe=new Ae(Q.comparator);function Me(){return Pe}var Fe=new Ae(Q.comparator);function Ve(){return Fe}var qe=new Ce(Q.comparator);function Ue(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=qe,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Be=new Ce(w);function je(){return Be}var Ke=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,Qe.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(T.min(),r,je(),Oe(),Ue())},t}(),Qe=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(L.EMPTY_BYTE_STRING,n,Ue(),Ue(),Ue())},t}(),Ge=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},ze=function(t,e){this.targetId=t,this.V=e},We=function(t,e,n,r){void 0===n&&(n=L.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},He=function(){function t(){this.S=0,this.D=Xe(),this.C=L.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,\"current\",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"resumeToken\",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"k\",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"$\",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=Ue(),e=Ue(),n=Ue();return this.D.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:y()}}),new Qe(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=Xe()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),Ye=function(){function t(t){this.W=t,this.G=new Map,this.H=Oe(),this.J=$e(),this.Y=new Ce(w)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.tt(r,t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:y()}})},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(function(t,r){n.st(r)&&e(r)})},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(lt(i))if(0===n){var o=new Q(i.path);this.tt(e,o,at.newNoDocument(o,T.min()))}else v(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach(function(r,i){var o=e.ot(i);if(o){if(r.current&&lt(o.target)){var s=new Q(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,at.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}});var r=Ue();this.J.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))});var i=new Ke(t,n,this.Y,this.H,r);return this.H=Oe(),this.J=$e(),this.Y=new Ce(w),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new He,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Ce(w),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||f(\"WatchChangeAggregator\",\"Detected inactive target\",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new He),this.W.getRemoteKeysForTarget(t).forEach(function(n){e.tt(t,n,null)})},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function $e(){return new Ae(Q.comparator)}function Xe(){return new Ae(Q.comparator)}var Je={asc:\"ASCENDING\",desc:\"DESCENDING\"},Ze={\"<\":\"LESS_THAN\",\"<=\":\"LESS_THAN_OR_EQUAL\",\">\":\"GREATER_THAN\",\">=\":\"GREATER_THAN_OR_EQUAL\",\"==\":\"EQUAL\",\"!=\":\"NOT_EQUAL\",\"array-contains\":\"ARRAY_CONTAINS\",in:\"IN\",\"not-in\":\"NOT_IN\",\"array-contains-any\":\"ARRAY_CONTAINS_ANY\"},tn=function(t,e){this.databaseId=t,this.I=e};function en(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\\.\\d*/,\"\").replace(\"Z\",\"\")+\".\"+(\"000000000\"+e.nanoseconds).slice(-9)+\"Z\":{seconds:\"\"+e.seconds,nanos:e.nanoseconds}}function nn(t,e){return t.I?e.toBase64():e.toUint8Array()}function rn(t,e){return en(t,e.toTimestamp())}function on(t){return v(!!t),T.fromTimestamp(function(t){var e=P(t);return new E(e.seconds,e.nanos)}(t))}function sn(t,e){return function(t){return new x([\"projects\",t.projectId,\"databases\",t.database])}(t).child(\"documents\").child(e).canonicalString()}function an(t){var e=x.fromString(t);return v(Cn(e)),e}function un(t,e){return sn(t.databaseId,e.path)}function cn(t,e){var n=an(e);if(n.get(1)!==t.databaseId.projectId)throw new u(a.INVALID_ARGUMENT,\"Tried to deserialize key from different project: \"+n.get(1)+\" vs \"+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new u(a.INVALID_ARGUMENT,\"Tried to deserialize key from different database: \"+n.get(3)+\" vs \"+t.databaseId.database);return new Q(dn(n))}function hn(t,e){return sn(t.databaseId,e)}function fn(t){var e=an(t);return 4===e.length?x.emptyPath():dn(e)}function ln(t){return new x([\"projects\",t.databaseId.projectId,\"databases\",t.databaseId.database]).canonicalString()}function dn(t){return v(t.length>4&&\"documents\"===t.get(4)),t.popFirst(5)}function pn(t,e,n){return{name:un(t,e),fields:n.value.mapValue.fields}}function yn(t,e,n){var r=cn(t,e.name),i=on(e.updateTime),o=new ot({mapValue:{fields:e.fields}}),s=at.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function vn(t,e){var n;if(e instanceof ve)n={update:pn(t,e.key,e.value)};else if(e instanceof Ee)n={delete:un(t,e.key)};else if(e instanceof me)n={update:pn(t,e.key,e.data),updateMask:kn(e.fieldMask)};else{if(!(e instanceof Te))return y();n={verify:un(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof Jt)return{fieldPath:e.field.canonicalString(),setToServerValue:\"REQUEST_TIME\"};if(n instanceof Zt)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ee)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof re)return{fieldPath:e.field.canonicalString(),increment:n.A};throw y()}(0,t)})),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:rn(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:y()}(t,e.precondition)),n}function mn(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?ue.updateTime(on(t.updateTime)):void 0!==t.exists?ue.exists(t.exists):ue.none()}(e.currentDocument):ue.none(),r=e.updateTransforms?e.updateTransforms.map(function(e){return function(t,e){var n=null;if(\"setToServerValue\"in e)v(\"REQUEST_TIME\"===e.setToServerValue),n=new Jt;else if(\"appendMissingElements\"in e){var r=e.appendMissingElements.values||[];n=new Zt(r)}else if(\"removeAllFromArray\"in e){var i=e.removeAllFromArray.values||[];n=new ee(i)}else\"increment\"in e?n=new re(t,e.increment):y();var o=C.fromServerFormat(e.fieldPath);return new se(o,n)}(t,e)}):[];if(e.update){e.update.name;var i=cn(t,e.update.name),o=new ot({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){var e=t.fieldPaths||[];return new R(e.map(function(t){return C.fromServerFormat(t)}))}(e.updateMask);return new me(i,o,s,n,r)}return new ve(i,o,n,r)}if(e.delete){var a=cn(t,e.delete);return new Ee(a,n)}if(e.verify){var u=cn(t,e.verify);return new Te(u,n)}return y()}function gn(t,e){return{documents:[hn(t,e.path)]}}function _n(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=hn(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=hn(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if(\"==\"===t.op){if(nt(t.value))return{unaryFilter:{field:Nn(t.field),op:\"IS_NAN\"}};if(et(t.value))return{unaryFilter:{field:Nn(t.field),op:\"IS_NULL\"}}}else if(\"!=\"===t.op){if(nt(t.value))return{unaryFilter:{field:Nn(t.field),op:\"IS_NOT_NAN\"}};if(et(t.value))return{unaryFilter:{field:Nn(t.field),op:\"IS_NOT_NULL\"}}}return{fieldFilter:{field:Nn(t.field),op:Sn(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:\"AND\",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:Nn(t.field),direction:Tn(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||B(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=In(e.startAt)),e.endAt&&(n.structuredQuery.endAt=In(e.endAt)),n}function wn(t){var e=fn(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){v(1===r);var s=n.from[0];s.allDescendants?i=s.collectionId:e=e.child(s.collectionId)}var a=[];n.where&&(a=bn(n.where));var u=[];n.orderBy&&(u=n.orderBy.map(function(t){return function(t){return new Tt(Dn(t.field),function(t){switch(t){case\"ASCENDING\":return\"asc\";case\"DESCENDING\":return\"desc\";default:return}}(t.direction))}(t)}));var c=null;n.limit&&(c=function(t){var e;return B(e=\"object\"==o(t)?t.value:t)?null:e}(n.limit));var h=null;n.startAt&&(h=En(n.startAt));var f=null;return n.endAt&&(f=En(n.endAt)),xt(e,i,u,a,c,\"F\",h,f)}function bn(t){return t?void 0!==t.unaryFilter?[xn(t)]:void 0!==t.fieldFilter?[An(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return bn(t)}).reduce(function(t,e){return t.concat(e)}):y():[]}function In(t){return{before:t.before,values:t.position}}function En(t){var e=!!t.before,n=t.values||[];return new It(n,e)}function Tn(t){return Je[t]}function Sn(t){return Ze[t]}function Nn(t){return{fieldPath:t.canonicalString()}}function Dn(t){return C.fromServerFormat(t.fieldPath)}function An(t){return dt.create(Dn(t.fieldFilter.field),function(t){switch(t){case\"EQUAL\":return\"==\";case\"NOT_EQUAL\":return\"!=\";case\"GREATER_THAN\":return\">\";case\"GREATER_THAN_OR_EQUAL\":return\">=\";case\"LESS_THAN\":return\"<\";case\"LESS_THAN_OR_EQUAL\":return\"<=\";case\"ARRAY_CONTAINS\":return\"array-contains\";case\"IN\":return\"in\";case\"NOT_IN\":return\"not-in\";case\"ARRAY_CONTAINS_ANY\":return\"array-contains-any\";case\"OPERATOR_UNSPECIFIED\":default:return y()}}(t.fieldFilter.op),t.fieldFilter.value)}function xn(t){switch(t.unaryFilter.op){case\"IS_NAN\":var e=Dn(t.unaryFilter.field);return dt.create(e,\"==\",{doubleValue:NaN});case\"IS_NULL\":var n=Dn(t.unaryFilter.field);return dt.create(n,\"==\",{nullValue:\"NULL_VALUE\"});case\"IS_NOT_NAN\":var r=Dn(t.unaryFilter.field);return dt.create(r,\"!=\",{doubleValue:NaN});case\"IS_NOT_NULL\":var i=Dn(t.unaryFilter.field);return dt.create(i,\"!=\",{nullValue:\"NULL_VALUE\"});case\"OPERATOR_UNSPECIFIED\":default:return y()}}function kn(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}}function Cn(t){return t.length>=4&&\"projects\"===t.get(0)&&\"databases\"===t.get(2)}function Rn(t){for(var e=\"\",n=0;n<t.length;n++)e.length>0&&(e=On(e)),e=Ln(t.get(n),e);return On(e)}function Ln(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case\"\\0\":n+=\"\u0001\u0010\";break;case\"\u0001\":n+=\"\u0001\u0011\";break;default:n+=o}}return n}function On(t){return t+\"\u0001\u0001\"}function Pn(t){var e=t.length;if(v(e>=2),2===e)return v(\"\u0001\"===t.charAt(0)&&\"\u0001\"===t.charAt(1)),x.emptyPath();for(var n=e-2,r=[],i=\"\",o=0;o<e;){var s=t.indexOf(\"\u0001\",o);switch((s<0||s>n)&&y(),t.charAt(s+1)){case\"\u0001\":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=\"\"),r.push(u);break;case\"\u0010\":i+=t.substring(o,s),i+=\"\\0\";break;case\"\u0011\":i+=t.substring(o,s+1);break;default:y()}o=s+2}return new x(r)}var Mn=function(t,e){this.seconds=t,this.nanoseconds=e},Fn=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Fn.store=\"owner\",Fn.key=\"owner\";var Vn=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Vn.store=\"mutationQueues\",Vn.keyPath=\"userId\";var qn=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};qn.store=\"mutations\",qn.keyPath=\"batchId\",qn.userMutationsIndex=\"userMutationsIndex\",qn.userMutationsKeyPath=[\"userId\",\"batchId\"];var Un=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Rn(e)]},t.key=function(t,e,n){return[t,Rn(e),n]},t}();Un.store=\"documentMutations\",Un.PLACEHOLDER=new Un;var Bn=function(t,e){this.path=t,this.readTime=e},jn=function(t,e){this.path=t,this.version=e},Kn=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Kn.store=\"remoteDocuments\",Kn.readTimeIndex=\"readTimeIndex\",Kn.readTimeIndexPath=\"readTime\",Kn.collectionReadTimeIndex=\"collectionReadTimeIndex\",Kn.collectionReadTimeIndexPath=[\"parentPath\",\"readTime\"];var Qn=function(t){this.byteSize=t};Qn.store=\"remoteDocumentGlobal\",Qn.key=\"remoteDocumentGlobalKey\";var Gn=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Gn.store=\"targets\",Gn.keyPath=\"targetId\",Gn.queryTargetsIndexName=\"queryTargetsIndex\",Gn.queryTargetsKeyPath=[\"canonicalId\",\"targetId\"];var zn=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};zn.store=\"targetDocuments\",zn.keyPath=[\"targetId\",\"path\"],zn.documentTargetsIndex=\"documentTargetsIndex\",zn.documentTargetsKeyPath=[\"path\",\"targetId\"];var Wn=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Wn.key=\"targetGlobalKey\",Wn.store=\"targetGlobal\";var Hn=function(t,e){this.collectionId=t,this.parent=e};Hn.store=\"collectionParents\",Hn.keyPath=[\"collectionId\",\"parent\"];var Yn=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Yn.store=\"clientMetadata\",Yn.keyPath=\"clientId\";var $n=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};$n.store=\"bundles\",$n.keyPath=\"bundleId\";var Xn=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};Xn.store=\"namedQueries\",Xn.keyPath=\"name\";var Jn=(0,e.__spreadArray)((0,e.__spreadArray)([],(0,e.__spreadArray)((0,e.__spreadArray)([],(0,e.__spreadArray)((0,e.__spreadArray)([],(0,e.__spreadArray)((0,e.__spreadArray)([],[Vn.store,qn.store,Un.store,Kn.store,Gn.store,Fn.store,Wn.store,zn.store]),[Yn.store])),[Qn.store])),[Hn.store])),[$n.store,Xn.store]),Zn=\"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.\",tr=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),er=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},nr=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&y(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),rr=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new er,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new sr(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=fr(e.target.error);n.ft.reject(new sr(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new sr(n,e)}},Object.defineProperty(t.prototype,\"dt\",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(f(\"SimpleDb\",\"Aborting transaction:\",t?t.message:\"Client-initiated abort\"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new ur(e)},t}(),ir=function(){function r(t,e,i){this.name=t,this.version=e,this.wt=i,12.2===r._t((0,n.getUA)())&&l(\"Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.\")}return r.delete=function(t){return f(\"SimpleDb\",\"Removing database:\",t),cr(window.indexedDB.deleteDatabase(t)).toPromise()},r.yt=function(){if(\"undefined\"==typeof indexedDB)return!1;if(r.gt())return!0;var t=(0,n.getUA)(),e=r._t(t),i=0<e&&e<10,o=r.Et(t),s=0<o&&o<4.5;return!(t.indexOf(\"MSIE \")>0||t.indexOf(\"Trident/\")>0||t.indexOf(\"Edge/\")>0||i||s)},r.gt=function(){var e;return void 0!==t&&\"YES\"===(null===(e=t.env)||void 0===e?void 0:e.Tt)},r.It=function(t,e){return t.store(e)},r._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\\d_]+)/i),n=e?e[1].split(\"_\").slice(0,2).join(\".\"):\"-1\";return Number(n)},r.Et=function(t){var e=t.match(/Android ([\\d.]+)/i),n=e?e[1].split(\".\").slice(0,2).join(\".\"):\"-1\";return Number(n)},r.prototype.At=function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n,r=this;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return this.db?[3,2]:(f(\"SimpleDb\",\"Opening database:\",this.name),n=this,[4,new Promise(function(e,n){var i=indexedDB.open(r.name,r.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){n(new sr(t,\"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed.\"))},i.onerror=function(e){var r=e.target.error;\"VersionError\"===r.name?n(new u(a.FAILED_PRECONDITION,\"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.\")):n(new sr(t,r))},i.onupgradeneeded=function(t){f(\"SimpleDb\",'Database \"'+r.name+'\" requires upgrade from version:',t.oldVersion);var e=t.target.result;r.wt.Rt(e,i.transaction,t.oldVersion,r.version).next(function(){f(\"SimpleDb\",\"Database upgrade to version \"+r.version+\" complete\")})}})]);case 1:n.db=e.sent(),e.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return r.bt(t)}),this.db)]}})})},r.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},r.prototype.runTransaction=function(t,n,r,i){return(0,e.__awaiter)(this,void 0,void 0,function(){var s,a,u,c,h;return(0,e.__generator)(this,function(l){switch(l.label){case 0:s=\"readonly\"===n,a=0,u=function(){var n,o,u,h,l;return(0,e.__generator)(this,function(e){switch(e.label){case 0:++a,e.label=1;case 1:return e.trys.push([1,4,,5]),[4,c.At(t)];case 2:return c.db=e.sent(),n=rr.open(c.db,t,s?\"readonly\":\"readwrite\",r),o=i(n).catch(function(t){return n.abort(t),nr.reject(t)}).toPromise(),u={},o.catch(function(){}),[4,n.dt];case 3:return[2,(u.value=(e.sent(),o),u)];case 4:return h=e.sent(),l=\"FirebaseError\"!==h.name&&a<3,f(\"SimpleDb\",\"Transaction failed with error:\",h.message,\"Retrying:\",l),c.close(),l?[3,5]:[2,{value:Promise.reject(h)}];case 5:return[2]}})},c=this,l.label=1;case 1:return[5,u()];case 2:if(\"object\"==o(h=l.sent()))return[2,h.value];l.label=3;case 3:return[3,1];case 4:return[2]}})})},r.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},r}(),or=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,\"isDone\",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"Dt\",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"cursor\",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return cr(this.Pt.delete())},t}(),sr=function(t){function n(e,n){var r=this;return(r=t.call(this,a.UNAVAILABLE,\"IndexedDB transaction '\"+e+\"' failed: \"+n)||this).name=\"IndexedDbTransactionError\",r}return(0,e.__extends)(n,t),n}(u);function ar(t){return\"IndexedDbTransactionError\"===t.name}var ur=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(f(\"SimpleDb\",\"PUT\",this.store.name,t,e),n=this.store.put(e,t)):(f(\"SimpleDb\",\"PUT\",this.store.name,\"<auto-key>\",t),n=this.store.put(t)),cr(n)},t.prototype.add=function(t){return f(\"SimpleDb\",\"ADD\",this.store.name,t,t),cr(this.store.add(t))},t.prototype.get=function(t){var e=this;return cr(this.store.get(t)).next(function(n){return void 0===n&&(n=null),f(\"SimpleDb\",\"GET\",e.store.name,t,n),n})},t.prototype.delete=function(t){return f(\"SimpleDb\",\"DELETE\",this.store.name,t),cr(this.store.delete(t))},t.prototype.count=function(){return f(\"SimpleDb\",\"COUNT\",this.store.name),cr(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.Ft=function(t,e){f(\"SimpleDb\",\"DELETE ALL\",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,function(t,e,n){return n.delete()})},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new nr(function(n,r){e.onerror=function(t){var e=fr(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.xt=function(t,e){var n=[];return new nr(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new or(i),s=e(i.primaryKey,i.value,o);if(s instanceof nr){var a=s.catch(function(t){return o.done(),nr.reject(t)});n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return nr.waitFor(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&(\"string\"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e=\"next\";if(t.reverse&&(e=\"prev\"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function cr(t){return new nr(function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=fr(t.target.error);n(e)}})}var hr=!1;function fr(t){var e=ir._t((0,n.getUA)());if(e>=12.2&&e<13){var r=\"An internal error was encountered in the Indexed Database server\";if(t.message.indexOf(r)>=0){var i=new u(\"internal\",\"IOS_INDEXEDDB_BUG1: IndexedDb has thrown '\"+r+\"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.\");return hr||(hr=!0,setTimeout(function(){throw i},0)),i}}return t}var lr=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return(0,e.__extends)(n,t),n}(tr);function dr(t,e){var n=m(t);return ir.It(n.Mt,e)}var pr=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&fe(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&le(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&le(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach(function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(T.min())})},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Ue())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&b(this.mutations,t.mutations,function(t,e){return pe(t,e)})&&b(this.baseMutations,t.baseMutations,function(t,e){return pe(t,e)})},t}(),yr=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){v(e.mutations.length===r.length);for(var i=Ve(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),vr=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=T.min()),void 0===o&&(o=T.min()),void 0===s&&(s=L.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),mr=function(t){this.Lt=t};function gr(t,e){if(e.document)return yn(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Q.fromSegments(e.noDocument.path),r=Er(e.noDocument.readTime),i=at.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=Q.fromSegments(e.unknownDocument.path);return r=Er(e.unknownDocument.version),at.newUnknownDocument(o,r)}return y()}function _r(t,e,n){var r=wr(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:un(t,e.key),fields:e.data.value.mapValue.fields,updateTime:en(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new Kn(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=Ir(e.version);return s=e.hasCommittedMutations,new Kn(null,new Bn(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=Ir(e.version);return new Kn(new jn(c,h),null,null,!0,r,i)}return y()}function wr(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function br(t){var e=new E(t[0],t[1]);return T.fromTimestamp(e)}function Ir(t){var e=t.toTimestamp();return new Mn(e.seconds,e.nanoseconds)}function Er(t){var e=new E(t.seconds,t.nanoseconds);return T.fromTimestamp(e)}function Tr(t,e){for(var n=(e.baseMutations||[]).map(function(e){return mn(t.Lt,e)}),r=0;r<e.mutations.length-1;++r){var i=e.mutations[r];if(r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform){var o=e.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}var s=e.mutations.map(function(e){return mn(t.Lt,e)}),a=E.fromMillis(e.localWriteTimeMs);return new pr(e.batchId,a,n,s)}function Sr(t){var e,n,r=Er(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Er(t.lastLimboFreeSnapshotVersion):T.min();return void 0!==t.query.documents?(v(1===(n=t.query).documents.length),e=Ft(kt(fn(n.documents[0])))):e=function(t){return Ft(wn(t))}(t.query),new vr(e,t.targetId,0,t.lastListenSequenceNumber,r,i,L.fromBase64String(t.resumeToken))}function Nr(t,e){var n,r=Ir(e.snapshotVersion),i=Ir(e.lastLimboFreeSnapshotVersion);n=lt(e.target)?gn(t.Lt,e.target):_n(t.Lt,e.target);var o=e.resumeToken.toBase64();return new Gn(e.targetId,ht(e.target),r,o,e.sequenceNumber,i,n)}function Dr(t){var e=wn({parent:t.parent,structuredQuery:t.structuredQuery});return\"LAST\"===t.limitType?Vt(e,e.limit,\"L\"):e}var Ar=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return xr(t).get(e).next(function(t){if(t)return{id:(e=t).bundleId,createTime:Er(e.createTime),version:e.version};var e})},t.prototype.saveBundleMetadata=function(t,e){return xr(t).put({bundleId:(n=e).id,createTime:Ir(on(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return kr(t).get(e).next(function(t){if(t)return{name:(e=t).name,query:Dr(e.bundledQuery),readTime:Er(e.readTime)};var e})},t.prototype.saveNamedQuery=function(t,e){return kr(t).put(function(t){return{name:t.name,readTime:Ir(on(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function xr(t){return dr(t,$n.store)}function kr(t){return dr(t,Xn.store)}var Cr=function(){function t(){this.Bt=new Rr}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),nr.resolve()},t.prototype.getCollectionParents=function(t,e){return nr.resolve(this.Bt.getEntries(e))},t}(),Rr=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Ce(x.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Ce(x.comparator)).toArray()},t}(),Lr=function(){function t(){this.qt=new Rr}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});var o={collectionId:r,parent:Rn(i)};return Or(t).put(o)}return nr.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,\"\"],[I(e),\"\"],!1,!0);return Or(t).Nt(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Pn(o.parent))}return n})},t}();function Or(t){return dr(t,Hn.store)}var Pr={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Mr=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function Fr(t,e,n){var r=t.store(qn.store),i=t.store(Un.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){v(1===a)}));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],d=Un.key(e,l.key.path,n.batchId);o.push(i.delete(d)),c.push(l.key)}return nr.waitFor(o).next(function(){return c})}function Vr(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw y();e=t.noDocument}return JSON.stringify(e).length}Mr.DEFAULT_COLLECTION_PERCENTILE=10,Mr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Mr.DEFAULT=new Mr(41943040,Mr.DEFAULT_COLLECTION_PERCENTILE,Mr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Mr.DISABLED=new Mr(-1,0,0);var qr=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}return t.Qt=function(e,n,r,i){return v(\"\"!==e.uid),new t(e.isAuthenticated()?e.uid:\"\",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Br(t).$t({index:qn.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=jr(t),s=Br(t);return s.add({}).next(function(a){v(\"number\"==typeof a);for(var u=new pr(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map(function(e){return vn(t.Lt,e)}),i=n.mutations.map(function(e){return vn(t.Lt,e)});return new qn(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],f=new Ce(function(t,e){return w(t.canonicalString(),e.canonicalString())}),l=0,d=r;l<d.length;l++){var p=d[l],y=Un.key(i.userId,p.key.path,a);f=f.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,Un.PLACEHOLDER))}return f.forEach(function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.Kt[a]=u.keys()}),nr.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Br(t).get(e).next(function(t){return t?(v(t.userId===n.userId),Tr(n.R,t)):null})},t.prototype.jt=function(t,e){var n=this;return this.Kt[e]?nr.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.Kt[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Br(t).$t({index:qn.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(v(e.batchId>=r),o=Tr(n.R,e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Br(t).$t({index:qn.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Br(t).Nt(qn.userMutationsIndex,n).next(function(t){return t.map(function(t){return Tr(e.R,t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Un.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return jr(t).$t({range:i},function(r,i,s){var a=r[0],u=r[1],c=r[2],h=Pn(u);if(a===n.userId&&e.path.isEqual(h))return Br(t).get(c).next(function(t){if(!t)throw y();v(t.userId===n.userId),o.push(Tr(n.R,t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Ce(w),i=[];return e.forEach(function(e){var o=Un.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=jr(t).$t({range:s},function(t,i,o){var s=t[0],a=t[1],u=t[2],c=Pn(a);s===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()});i.push(a)}),nr.waitFor(i).next(function(){return n.Wt(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=Un.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new Ce(w);return jr(t).$t({range:s},function(t,e,o){var s=t[0],u=t[1],c=t[2],h=Pn(u);s===n.userId&&r.isPrefixOf(h)?h.length===i&&(a=a.add(c)):o.done()}).next(function(){return n.Wt(t,a)})},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Br(t).get(e).next(function(t){if(null===t)throw y();v(t.userId===n.userId),r.push(Tr(n.R,t))}))}),nr.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return Fr(t.Mt,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.Gt(e.batchId)}),nr.forEach(r,function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)})})},t.prototype.Gt=function(t){delete this.Kt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return nr.resolve();var r=IDBKeyRange.lowerBound(Un.prefixForUser(e.userId)),i=[];return jr(t).$t({range:r},function(t,n,r){if(t[0]===e.userId){var o=Pn(t[1]);i.push(o)}else r.done()}).next(function(){v(0===i.length)})})},t.prototype.containsKey=function(t,e){return Ur(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return Kr(t).get(this.userId).next(function(t){return t||new Vn(e.userId,-1,\"\")})},t}();function Ur(t,e,n){var r=Un.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return jr(t).$t({range:o,kt:!0},function(t,n,r){var o=t[0],a=t[1];t[2],o===e&&a===i&&(s=!0),r.done()}).next(function(){return s})}function Br(t){return dr(t,qn.store)}function jr(t){return dr(t,Un.store)}function Kr(t){return dr(t,Vn.store)}var Qr=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),Gr=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next(function(n){var r=new Qr(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return T.fromTimestamp(new E(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next(function(){return n.Xt(t).next(function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return zr(t).delete(e.targetId)}).next(function(){return n.Xt(t)}).next(function(e){return v(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return zr(t).$t(function(s,a){var u=Sr(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))}).next(function(){return nr.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){return zr(t).$t(function(t,n){var r=Sr(n);e(r)})},t.prototype.Xt=function(t){return Wr(t).get(Wn.key).next(function(t){return v(null!==t),t})},t.prototype.Zt=function(t,e){return Wr(t).put(Wn.key,e)},t.prototype.te=function(t,e){return zr(t).put(Nr(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=ht(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return zr(t).$t({range:r,index:Gn.queryTargetsIndexName},function(t,n,r){var o=Sr(n);ft(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Hr(t);return e.forEach(function(e){var s=Rn(e.path);i.push(o.put(new zn(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))}),nr.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Hr(t);return nr.forEach(e,function(e){var o=Rn(e.path);return nr.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Hr(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Hr(t),i=Ue();return r.$t({range:n,kt:!0},function(t,e,n){var r=Pn(t[1]),o=new Q(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=Rn(e.path),r=IDBKeyRange.bound([n],[I(n)],!1,!0),i=0;return Hr(t).$t({index:zn.documentTargetsIndex,kt:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return i>0})},t.prototype.lt=function(t,e){return zr(t).get(e).next(function(t){return t?Sr(t):null})},t}();function zr(t){return dr(t,Gn.store)}function Wr(t){return dr(t,Wn.store)}function Hr(t){return dr(t,zn.store)}function Yr(t){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){if(t.code!==a.FAILED_PRECONDITION||t.message!==Zn)throw t;return f(\"LocalStore\",\"Unexpectedly lost primary lease\"),[2]})})}function $r(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=w(n,i);return 0===s?w(r,o):s}var Xr=function(){function t(t){this.ne=t,this.buffer=new Ce($r),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();$r(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,\"maxValue\",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Jr=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,\"started\",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var n=this,r=this.oe?3e5:6e4;f(\"LruGarbageCollector\",\"Garbage collection scheduled in \"+r+\"ms\"),this.ce=this.asyncQueue.enqueueAfterDelay(\"lru_garbage_collection\",r,function(){return(0,e.__awaiter)(n,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:this.ce=null,this.oe=!0,e.label=1;case 1:return e.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return e.sent(),[3,7];case 3:return ar(n=e.sent())?(f(\"LruGarbageCollector\",\"Ignoring IndexedDB error during garbage collection: \",n),[3,6]):[3,4];case 4:return[4,Yr(n)];case 5:e.sent(),e.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return e.sent(),[2]}})})})},t}(),Zr=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return nr.resolve(s.o);var r=new Xr(e);return this.ae.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ae.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(f(\"LruGarbageCollector\",\"Garbage collection skipped; disabled\"),nr.resolve(Pr)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(f(\"LruGarbageCollector\",\"Garbage collection skipped; Cache size \"+r+\" is lower than threshold \"+n.params.cacheSizeCollectionThreshold),Pr):n.fe(t,e)})},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,i,o,s,a,u,c,l=this,d=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>l.params.maximumSequenceNumbersToCollect?(f(\"LruGarbageCollector\",\"Capping sequence numbers to collect down to the maximum of \"+l.params.maximumSequenceNumbersToCollect+\" from \"+e),i=l.params.maximumSequenceNumbersToCollect):i=e,s=Date.now(),l.nthSequenceNumber(t,i)}).next(function(r){return n=r,a=Date.now(),l.removeTargets(t,n,e)}).next(function(e){return o=e,u=Date.now(),l.removeOrphanedDocuments(t,n)}).next(function(t){return c=Date.now(),h()<=r.LogLevel.DEBUG&&f(\"LruGarbageCollector\",\"LRU Garbage Collection\\n\\tCounted targets in \"+(s-d)+\"ms\\n\\tDetermined least recently used \"+i+\" in \"+(a-s)+\"ms\\n\\tRemoved \"+o+\" targets in \"+(u-a)+\"ms\\n\\tRemoved \"+t+\" documents in \"+(c-u)+\"ms\\nTotal Duration: \"+(c-d)+\"ms\"),nr.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:t})})},t}(),ti=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new Zr(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,function(t,n){return e(n)})},t.prototype.addReference=function(t,e,n){return ei(t,n)},t.prototype.removeReference=function(t,e,n){return ei(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return ei(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return Kr(t).Ot(function(r){return Ur(t,r,e).next(function(t){return t&&(n=!0),nr.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,function(s,a){if(a<=e){var u=n._e(t,s).next(function(e){if(!e)return o++,r.getEntry(t,s).next(function(){return r.removeEntry(s),Hr(t).delete([0,Rn(s.path)])})});i.push(u)}}).next(function(){return nr.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return ei(t,e)},t.prototype.we=function(t,e){var n,r=Hr(t),i=s.o;return r.$t({index:zn.documentTargetsIndex},function(t,r){var o=t[0];t[1];var a=r.path,u=r.sequenceNumber;0===o?(i!==s.o&&e(new Q(Pn(n)),i),i=u,n=a):i=s.o}).next(function(){i!==s.o&&e(new Q(Pn(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function ei(t,e){return Hr(t).put(function(t,e){return new zn(0,Rn(t.path),e)}(e,t.currentSequenceNumber))}var ni=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(this.equalsFn(s,t))return a}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){N(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];t(s,a)}})},t.prototype.isEmpty=function(){return D(this.inner)},t}(),ri=function(){function t(){this.changes=new ni(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:T.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:at.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?nr.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),ii=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return ai(t).put(ui(e),n)},t.prototype.removeEntry=function(t,e){var n=ai(t),r=ui(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.me(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return ai(t).get(ui(e)).next(function(t){return n.ye(e,t)})},t.prototype.ge=function(t,e){var n=this;return ai(t).get(ui(e)).next(function(t){return{document:n.ye(e,t),size:Vr(t)}})},t.prototype.getEntries=function(t,e){var n=this,r=Oe();return this.pe(t,e,function(t,e){var i=n.ye(t,e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.Ee=function(t,e){var n=this,r=Oe(),i=new Ae(Q.comparator);return this.pe(t,e,function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,Vr(e))}).next(function(){return{documents:r,Te:i}})},t.prototype.pe=function(t,e,n){if(e.isEmpty())return nr.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return ai(t).$t({range:r},function(t,e,r){for(var s=Q.fromSegments(t);o&&Q.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=Oe(),o=e.path.length+1,s={};if(n.isEqual(T.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=wr(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=Kn.collectionReadTimeIndex}return ai(t).$t(s,function(t,n,s){if(t.length===o){var a=gr(r.R,n);e.path.isPrefixOf(a.key.path)?jt(e,a)&&(i=i.insert(a.key,a)):s.done()}}).next(function(){return i})},t.prototype.newChangeBuffer=function(t){return new oi(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return si(t).get(Qn.key).next(function(t){return v(!!t),t})},t.prototype.me=function(t,e){return si(t).put(Qn.key,e)},t.prototype.ye=function(t,e){if(e){var n=gr(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(T.min()))return n}return at.newInvalidDocument(t)},t}(),oi=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new ni(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return(0,e.__extends)(n,t),n.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Ce(function(t,e){return w(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=_r(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=Vr(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=_r(e.Ie.R,at.newNoDocument(o,T.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))}),i.forEach(function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))}),n.push(this.Ie.updateMetadata(t,r)),nr.waitFor(n)},n.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},n.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},n}(ri);function si(t){return dr(t,Qn.store)}function ai(t){return dr(t,Kn.store)}function ui(t){return t.path.toArray()}var ci=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;v(n<r&&n>=0&&r<=11);var o=new rr(\"createOrUpgrade\",e);n<1&&r>=1&&(function(t){t.createObjectStore(Fn.store)}(t),function(t){t.createObjectStore(Vn.store,{keyPath:Vn.keyPath}),t.createObjectStore(qn.store,{keyPath:qn.keyPath,autoIncrement:!0}).createIndex(qn.userMutationsIndex,qn.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Un.store)}(t),hi(t),function(t){t.createObjectStore(Kn.store)}(t));var s=nr.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(zn.store),t.deleteObjectStore(Gn.store),t.deleteObjectStore(Wn.store)}(t),hi(t)),s=s.next(function(){return t=o.store(Wn.store),e=new Wn(0,0,T.min().toTimestamp(),0),t.put(Wn.key,e);var t,e})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return function(t,e){return e.store(qn.store).Nt().next(function(n){t.deleteObjectStore(qn.store),t.createObjectStore(qn.store,{keyPath:qn.keyPath,autoIncrement:!0}).createIndex(qn.userMutationsIndex,qn.userMutationsKeyPath,{unique:!0});var r=e.store(qn.store),i=n.map(function(t){return r.put(t)});return nr.waitFor(i)})}(t,o)})),s=s.next(function(){!function(t){t.createObjectStore(Yn.store,{keyPath:Yn.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(function(){return i.Re(o)})),n<6&&r>=6&&(s=s.next(function(){return function(t){t.createObjectStore(Qn.store)}(t),i.be(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ve(o)})),n<8&&r>=8&&(s=s.next(function(){return i.Pe(t,o)})),n<9&&r>=9&&(s=s.next(function(){!function(t){t.objectStoreNames.contains(\"remoteDocumentChanges\")&&t.deleteObjectStore(\"remoteDocumentChanges\")}(t),function(t){var e=t.objectStore(Kn.store);e.createIndex(Kn.readTimeIndex,Kn.readTimeIndexPath,{unique:!1}),e.createIndex(Kn.collectionReadTimeIndex,Kn.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(s=s.next(function(){return i.Ve(o)})),n<11&&r>=11&&(s=s.next(function(){!function(t){t.createObjectStore($n.store,{keyPath:$n.keyPath})}(t),function(t){t.createObjectStore(Xn.store,{keyPath:Xn.keyPath})}(t)})),s},t.prototype.be=function(t){var e=0;return t.store(Kn.store).$t(function(t,n){e+=Vr(n)}).next(function(){var n=new Qn(e);return t.store(Qn.store).put(Qn.key,n)})},t.prototype.Re=function(t){var e=this,n=t.store(Vn.store),r=t.store(qn.store);return n.Nt().next(function(n){return nr.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(qn.userMutationsIndex,i).next(function(r){return nr.forEach(r,function(r){v(r.userId===n.userId);var i=Tr(e.R,r);return Fr(t,n.userId,i).next(function(){})})})})})},t.prototype.ve=function(t){var e=t.store(zn.store),n=t.store(Kn.store);return t.store(Wn.store).get(Wn.key).next(function(t){var r=[];return n.$t(function(n,i){var o=new x(n),s=[0,Rn(o)];r.push(e.get(s).next(function(n){return n?nr.resolve():function(n){return e.put(new zn(0,Rn(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return nr.waitFor(r)})})},t.prototype.Pe=function(t,e){t.createObjectStore(Hn.store,{keyPath:Hn.keyPath});var n=e.store(Hn.store),r=new Rr,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:Rn(i)})}};return e.store(Kn.store).$t({kt:!0},function(t,e){var n=new x(t);return i(n.popLast())}).next(function(){return e.store(Un.store).$t({kt:!0},function(t,e){t[0];var n=t[1];t[2];var r=Pn(n);return i(r.popLast())})})},t.prototype.Ve=function(t){var e=this,n=t.store(Gn.store);return n.$t(function(t,r){var i=Sr(r),o=Nr(e.R,i);return n.put(o)})},t}();function hi(t){t.createObjectStore(zn.store,{keyPath:zn.keyPath}).createIndex(zn.documentTargetsIndex,zn.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Gn.store,{keyPath:Gn.keyPath}).createIndex(Gn.queryTargetsIndexName,Gn.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Wn.store)}var fi=\"Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.\",li=function(){function t(e,n,r,i,o,s,c,h,f,d){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=c,this.De=f,this.Ce=d,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new u(a.UNIMPLEMENTED,\"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.\");this.referenceDelegate=new ti(this,i),this.Le=n+\"main\",this.R=new mr(h),this.Be=new ir(this.Le,11,new ci(this.R)),this.qe=new Gr(this.referenceDelegate,this.R),this.Ut=new Lr,this.Ue=function(t,e){return new ii(t,e)}(this.R,this.Ut),this.Ke=new Ar,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===d&&l(\"IndexedDbPersistence\",\"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page.\"))}return t.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new u(a.FAILED_PRECONDITION,fi);return t.We(),t.Ge(),t.ze(),t.runTransaction(\"getHighestListenSequenceNumber\",\"readonly\",function(e){return t.qe.getHighestSequenceNumber(e)})}).then(function(e){t.Ne=new s(e,t.De)}).then(function(){t.xe=!0}).catch(function(e){return t.Be&&t.Be.close(),Promise.reject(e)})},t.prototype.He=function(t){var n=this;return this.Me=function(r){return(0,e.__awaiter)(n,void 0,void 0,function(){return(0,e.__generator)(this,function(e){return this.started?[2,t(r)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var n=this;this.Be.vt(function(r){return(0,e.__awaiter)(n,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return null===r.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var n=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return(0,e.__awaiter)(n,void 0,void 0,function(){return(0,e.__generator)(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.je=function(){var t=this;return this.runTransaction(\"updateClientMetadataAndTryBecomePrimary\",\"readwrite\",function(e){return pi(e).put(new Yn(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(e).next(function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(e)}).next(function(n){return t.isPrimary&&!n?t.Xe(e).next(function(){return!1}):!!n&&t.Ze(e).next(function(){return!0})})}).catch(function(e){if(ar(e))return f(\"IndexedDbPersistence\",\"Failed to extend owner lease: \",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return f(\"IndexedDbPersistence\",\"Releasing owner lease after error during lease refresh\",e),!1}).then(function(e){t.isPrimary!==e&&t.Se.enqueueRetryable(function(){return t.Me(e)}),t.isPrimary=e})},t.prototype.Je=function(t){var e=this;return di(t).get(Fn.key).next(function(t){return nr.resolve(e.tn(t))})},t.prototype.en=function(t){return pi(t).delete(this.clientId)},t.prototype.nn=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t,n,r,i,o=this;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction(\"maybeGarbageCollectMultiClientState\",\"readwrite-primary\",function(t){var e=dr(t,Yn.store);return e.Nt().next(function(t){var n=o.rn(t,18e5),r=t.filter(function(t){return-1===n.indexOf(t)});return nr.forEach(r,function(t){return e.delete(t.clientId)}).next(function(){return r})})}).catch(function(){return[]})]);case 1:if(t=e.sent(),this.Qe)for(n=0,r=t;n<r.length;n++)i=r[n],this.Qe.removeItem(this.on(i.clientId));e.label=2;case 2:return[2]}})})},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay(\"client_metadata_refresh\",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?nr.resolve(!0):di(t).get(Fn.key).next(function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new u(a.FAILED_PRECONDITION,fi);return!1}}return!(!e.networkEnabled||!e.inForeground)||pi(t).Nt().next(function(t){return void 0===e.rn(t,5e3).find(function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1})})}).next(function(t){return e.isPrimary!==t&&f(\"IndexedDbPersistence\",\"Client \"+(t?\"is\":\"is not\")+\" eligible for a primary lease.\"),t})},t.prototype.shutdown=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t=this;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction(\"shutdown\",\"readwrite\",[Fn.store,Yn.store],function(e){var n=new lr(e,s.o);return t.Xe(n).next(function(){return t.en(n)})})];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}})})},t.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},t.prototype.fn=function(){var t=this;return this.runTransaction(\"getActiveClients\",\"readonly\",function(e){return pi(e).Nt().next(function(e){return t.rn(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,\"started\",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return qr.Qt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;f(\"IndexedDbPersistence\",\"Starting transaction:\",t);var i,o=\"readonly\"===e?\"readonly\":\"readwrite\";return this.Be.runTransaction(t,o,Jn,function(o){return i=new lr(o,r.Ne?r.Ne.next():s.o),\"readwrite-primary\"===e?r.Je(i).next(function(t){return!!t||r.Ye(i)}).next(function(e){if(!e)throw l(\"Failed to obtain primary lease for action '\"+t+\"'.\"),r.isPrimary=!1,r.Se.enqueueRetryable(function(){return r.Me(!1)}),new u(a.FAILED_PRECONDITION,Zn);return n(i)}).next(function(t){return r.Ze(i).next(function(){return t})}):r.dn(i).next(function(){return n(i)})}).then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.dn=function(t){var e=this;return di(t).get(Fn.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new u(a.FAILED_PRECONDITION,fi)})},t.prototype.Ze=function(t){var e=new Fn(this.clientId,this.allowTabSynchronization,Date.now());return di(t).put(Fn.key,e)},t.yt=function(){return ir.yt()},t.prototype.Xe=function(t){var e=this,n=di(t);return n.get(Fn.key).next(function(t){return e.tn(t)?(f(\"IndexedDbPersistence\",\"Releasing primary lease.\"),n.delete(Fn.key)):nr.resolve()})},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(l(\"Detected an update time that is in the future: \"+t+\" > \"+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&\"function\"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget(function(){return t.inForeground=\"visible\"===t.document.visibilityState,t.je()})},this.document.addEventListener(\"visibilitychange\",this.ke),this.inForeground=\"visible\"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener(\"visibilitychange\",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;\"function\"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener(\"pagehide\",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener(\"pagehide\",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return f(\"IndexedDbPersistence\",\"Client '\"+t+\"' \"+(n?\"is\":\"is not\")+\" zombied in LocalStorage\"),n}catch(t){return l(\"IndexedDbPersistence\",\"Failed to get zombied client id.\",t),!1}},t.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){l(\"Failed to set zombie client id.\",t)}},t.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return\"firestore_zombie_\"+this.persistenceKey+\"_\"+t},t}();function di(t){return dr(t,Fn.store)}function pi(t){return dr(t,Yn.store)}function yi(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+=\".\"+t.database),\"firestore/\"+e+\"/\"+n+\"/\"}var vi=function(t,e){this.progress=t,this.wn=e},mi=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.yn(t,e,r)})},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t})},t.prototype.gn=function(t,e){t.forEach(function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)})},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next(function(e){return n.En(t,e).next(function(){return e})})},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return Q.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):Pt(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new Q(e)).next(function(t){var e=Me();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=Me();return this.Ut.getCollectionParents(t,i).next(function(s){return nr.forEach(s,function(s){var a=function(t,e){return new At(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return i=e,o.Rn(t,i,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=at.newInvalidDocument(c),r=r.insert(c,h)),le(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}})}).next(function(){return r.forEach(function(t,n){jt(e,n)||(r=r.remove(t))}),r})},t.prototype.Rn=function(t,e,n){for(var r=Ue(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof me&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},t}(),gi=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=Ue(),i=Ue(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),_i=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,i){var o=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(T.min())?this.Dn(t,e):this.Sn.pn(t,i).next(function(s){var a=o.Cn(e,s);return(Ct(e)||Rt(e))&&o.Nn(e.limitType,a,i,n)?o.Dn(t,e):(h()<=r.LogLevel.DEBUG&&f(\"QueryEngine\",\"Re-using previous result from %s to execute query: %s\",n.toString(),Bt(e)),o.Sn.getDocumentsMatchingQuery(t,e,n).next(function(t){return a.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.Cn=function(t,e){var n=new Ce(Kt(t));return e.forEach(function(e,r){jt(t,r)&&(n=n.add(r))}),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i=\"F\"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return h()<=r.LogLevel.DEBUG&&f(\"QueryEngine\",\"Using full collection scan to execute query:\",Bt(e)),this.Sn.getDocumentsMatchingQuery(t,e,T.min())},t}(),wi=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new Ae(w),this.kn=new ni(function(t){return ht(t)},ft),this.$n=T.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new mi(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction(\"Collect garbage\",\"readwrite-primary\",function(n){return t.collect(n,e.Fn)})},t}();function bi(t,e,n,r){return new wi(t,e,n,r)}function Ii(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r=m(t),i=r._n,o=r.Mn,[4,r.persistence.runTransaction(\"Handle user change\",\"readonly\",function(t){var e;return r._n.getAllMutationBatches(t).next(function(s){return e=s,i=r.persistence.getMutationQueue(n),o=new mi(r.On,i,r.persistence.getIndexManager()),i.getAllMutationBatches(t)}).next(function(n){for(var r=[],i=[],s=Ue(),a=0,u=e;a<u.length;a++){var c=u[a];r.push(c.batchId);for(var h=0,f=c.mutations;h<f.length;h++){var l=f[h];s=s.add(l.key)}}for(var d=0,p=n;d<p.length;d++){var y=p[d];i.push(y.batchId);for(var v=0,m=y.mutations;v<m.length;v++){var g=m[v];s=s.add(g.key)}}return o.pn(t,s).next(function(t){return{Ln:t,removedBatchIds:r,addedBatchIds:i}})})})];case 1:return s=e.sent(),[2,(r._n=i,r.Mn=o,r.xn.Vn(r.Mn),s)]}})})}function Ei(t,e){var n=m(t);return n.persistence.runTransaction(\"Acknowledge batch\",\"readwrite-primary\",function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=nr.resolve();return o.forEach(function(t){s=s.next(function(){return r.getEntry(e,t)}).next(function(e){var o=n.docVersions.get(t);v(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))})}),s.next(function(){return t._n.removeMutationBatch(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}function Ti(t){var e=m(t);return e.persistence.runTransaction(\"Get last remote snapshot version\",\"readonly\",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function Si(t,e){var n=m(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction(\"Apply remote event\",\"readwrite-primary\",function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach(function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next(function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)}));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return v(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}});var a=Oe();if(e.documentUpdates.forEach(function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),s.push(Ni(t,o,e.documentUpdates,r,void 0).next(function(t){a=t})),!r.isEqual(T.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next(function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)});s.push(u)}return nr.waitFor(s).next(function(){return o.apply(t)}).next(function(){return n.Mn.En(t,a)}).next(function(){return a})}).then(function(t){return n.Fn=i,t})}function Ni(t,e,n,r,i){var o=Ue();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=Oe();return n.forEach(function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(T.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):f(\"LocalStore\",\"Ignoring outdated watch update for \",n,\". Current version:\",a.version,\" Watch version:\",s.version)}),o})}function Di(t,e){var n=m(t);return n.persistence.runTransaction(\"Get next mutation batch\",\"readonly\",function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)})}function Ai(t,e){var n=m(t);return n.persistence.runTransaction(\"Allocate target\",\"readwrite\",function(t){var r;return n.qe.getTargetData(t,e).next(function(i){return i?(r=i,nr.resolve(r)):n.qe.allocateTargetId(t).next(function(i){return r=new vr(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next(function(){return r})})})}).then(function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t})}function xi(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s,a;return(0,e.__generator)(this,function(e){switch(e.label){case 0:i=m(t),o=i.Fn.get(n),s=r?\"readwrite\":\"readwrite-primary\",e.label=1;case 1:return e.trys.push([1,4,,5]),r?[3,3]:[4,i.persistence.runTransaction(\"Release target\",s,function(t){return i.persistence.referenceDelegate.removeTarget(t,o)})];case 2:e.sent(),e.label=3;case 3:return[3,5];case 4:if(!ar(a=e.sent()))throw a;return f(\"LocalStore\",\"Failed to update sequence numbers for target \"+n+\": \"+a),[3,5];case 5:return i.Fn=i.Fn.remove(n),i.kn.delete(o.target),[2]}})})}function ki(t,e,n){var r=m(t),i=T.min(),o=Ue();return r.persistence.runTransaction(\"Execute query\",\"readonly\",function(t){return function(t,e,n){var r=m(t),i=r.kn.get(n);return void 0!==i?nr.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,Ft(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next(function(t){o=t})}).next(function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:T.min(),n?o:Ue())}).next(function(t){return{documents:t,Bn:o}})})}function Ci(t,e){var n=m(t),r=m(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction(\"Get target data\",\"readonly\",function(t){return r.lt(t,e).next(function(t){return t?t.target:null})})}function Ri(t){var e=m(t);return e.persistence.runTransaction(\"Get new document changes\",\"readonly\",function(t){return function(t,e,n){var r=m(t),i=Oe(),o=wr(n),s=ai(e),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:Kn.readTimeIndex,range:a},function(t,e){var n=gr(r.R,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{wn:i,readTime:br(o)}})}(e.On,t,e.$n)}).then(function(t){var n=t.wn,r=t.readTime;return e.$n=r,n})}function Li(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){return[2,(n=m(t)).persistence.runTransaction(\"Synchronize last document change read time\",\"readonly\",function(t){return function(t){var e=ai(t),n=T.min();return e.$t({index:Kn.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=br(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){n.$n=t})]})})}function Oi(t,n,r,i){return(0,e.__awaiter)(this,void 0,void 0,function(){var o,s,a,u,c,h,f,l,d,p;return(0,e.__generator)(this,function(e){switch(e.label){case 0:for(o=m(t),s=Ue(),a=Oe(),u=Ve(),c=0,h=r;c<h.length;c++)f=h[c],l=n.qn(f.metadata.name),f.document&&(s=s.add(l)),a=a.insert(l,n.Un(f)),u=u.insert(l,n.Kn(f.metadata.readTime));return d=o.On.newChangeBuffer({trackRemovals:!0}),[4,Ai(o,function(t){return Ft(kt(x.fromString(\"__bundle__/docs/\"+t)))}(i))];case 1:return p=e.sent(),[2,o.persistence.runTransaction(\"Apply bundle documents\",\"readwrite\",function(t){return Ni(t,d,a,T.min(),u).next(function(e){return d.apply(t),e}).next(function(e){return o.qe.removeMatchingKeysForTargetId(t,p.targetId).next(function(){return o.qe.addMatchingKeys(t,s,p.targetId)}).next(function(){return o.Mn.En(t,e)}).next(function(){return e})})})]}})})}function Pi(t,n,r){return void 0===r&&(r=Ue()),(0,e.__awaiter)(this,void 0,void 0,function(){var i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,Ai(t,Ft(Dr(n.bundledQuery)))];case 1:return i=e.sent(),[2,(o=m(t)).persistence.runTransaction(\"Save named query\",\"readwrite\",function(t){var e=on(n.readTime);if(i.snapshotVersion.compareTo(e)>=0)return o.Ke.saveNamedQuery(t,n);var s=i.withResumeToken(L.EMPTY_BYTE_STRING,e);return o.Fn=o.Fn.insert(s.targetId,s),o.qe.updateTargetData(t,s).next(function(){return o.qe.removeMatchingKeysForTargetId(t,i.targetId)}).next(function(){return o.qe.addMatchingKeys(t,r,i.targetId)}).next(function(){return o.Ke.saveNamedQuery(t,n)})})]}})})}var Mi=function(){function t(t){this.R=t,this.Qn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return nr.resolve(this.Qn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Qn.set(e.id,{id:(n=e).id,version:n.version,createTime:on(n.createTime)}),nr.resolve()},t.prototype.getNamedQuery=function(t,e){return nr.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:Dr(t.bundledQuery),readTime:on(t.readTime)}}(e)),nr.resolve()},t}(),Fi=function(){function t(){this.Wn=new Ce(Vi.Gn),this.zn=new Ce(Vi.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new Vi(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.Yn(new Vi(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.Zn=function(t){var e=this,n=new Q(new x([])),r=new Vi(n,t),i=new Vi(n,t+1),o=[];return this.zn.forEachInRange([r,i],function(t){e.Yn(t),o.push(t.key)}),o},t.prototype.ts=function(){var t=this;this.Wn.forEach(function(e){return t.Yn(e)})},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new Q(new x([])),n=new Vi(e,t),r=new Vi(e,t+1),i=Ue();return this.zn.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new Vi(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Vi=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return Q.comparator(t.key,e.key)||w(t.ns,e.ns)},t.Hn=function(t,e){return w(t.ns,e.ns)||Q.comparator(t.key,e.key)},t}(),qi=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Ce(Vi.Gn)}return t.prototype.checkEmpty=function(t){return nr.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++,this._n.length>0&&this._n[this._n.length-1];var o=new pr(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new Vi(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return nr.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return nr.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.cs(n),i=r<0?0:r;return nr.resolve(this._n.length>i?this._n[i]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return nr.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return nr.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Vi(e,0),i=new Vi(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(t){var e=n.os(t.ns);o.push(e)}),nr.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Ce(w);return e.forEach(function(t){var e=new Vi(t,0),i=new Vi(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],function(t){r=r.add(t.ns)})}),nr.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;Q.isDocumentKey(i)||(i=i.child(\"\"));var o=new Vi(new Q(i),0),s=new Ce(w);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)},o),nr.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.os(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;v(0===this.hs(e.batchId,\"removed\")),this._n.shift();var r=this.rs;return nr.forEach(e.mutations,function(i){var o=new Vi(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.rs=r})},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new Vi(e,0),r=this.rs.firstAfterOrEqual(n);return nr.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return this._n.length,nr.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),Ui=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Ae(Q.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return nr.resolve(n?n.document.clone():at.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=Oe();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():at.newInvalidDocument(t))}),nr.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Oe(),i=new Q(e.path.child(\"\")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.key,u=s.value,c=u.document,h=u.readTime;if(!e.path.isPrefixOf(a.path))break;h.compareTo(n)<=0||jt(e,c)&&(r=r.insert(c.key,c.clone()))}return nr.resolve(r)},t.prototype.fs=function(t,e){return nr.forEach(this.docs,function(t){return e(t)})},t.prototype.newChangeBuffer=function(t){return new Bi(this)},t.prototype.getSize=function(t){return nr.resolve(this.size)},t}(),Bi=function(t){function n(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return(0,e.__extends)(n,t),n.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)}),nr.waitFor(n)},n.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},n.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},n}(ri),ji=function(){function t(t){this.persistence=t,this.ds=new ni(function(t){return ht(t)},ft),this.lastRemoteSnapshotVersion=T.min(),this.highestTargetId=0,this.ws=0,this._s=new Fi,this.targetCount=0,this.ys=Qr.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach(function(t,n){return e(n)}),nr.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return nr.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return nr.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),nr.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),nr.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new Qr(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,nr.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),nr.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,nr.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach(function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),nr.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return nr.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return nr.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),nr.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),nr.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),nr.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return nr.resolve(n)},t.prototype.containsKey=function(t,e){return nr.resolve(this._s.containsKey(e))},t}(),Ki=function(){function t(t,e){var n=this;this.gs={},this.Ne=new s(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new ji(this),this.Ut=new Cr,this.Ue=function(t,e){return new Ui(t,function(t){return n.referenceDelegate.ps(t)})}(this.Ut),this.R=new mr(e),this.Ke=new Mi(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,\"started\",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new qi(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;f(\"MemoryPersistence\",\"Starting transaction:\",t);var i=new Qi(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.Is=function(t,e){return nr.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(t,e)}}))},t}(),Qi=function(t){function n(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return(0,e.__extends)(n,t),n}(tr),Gi=function(){function t(t){this.persistence=t,this.As=new Fi,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,\"vs\",{get:function(){if(this.Rs)return this.Rs;throw y()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),nr.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),nr.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),nr.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return nr.forEach(this.vs,function(r){var i=Q.fromPath(r);return e.Ps(t,i).next(function(t){t||n.removeEntry(i)})}).next(function(){return e.Rs=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return nr.or([function(){return nr.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),zi=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?\"uid:\"+this.uid:\"anonymous-user\"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function Wi(t,e){return\"firestore_clients_\"+t+\"_\"+e}function Hi(t,e,n){var r=\"firestore_mutations_\"+t+\"_\"+n;return e.isAuthenticated()&&(r+=\"_\"+e.uid),r}function Yi(t,e){return\"firestore_targets_\"+t+\"_\"+e}zi.UNAUTHENTICATED=new zi(null),zi.GOOGLE_CREDENTIALS=new zi(\"google-credentials-uid\"),zi.FIRST_PARTY=new zi(\"first-party-uid\");var $i=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,s=JSON.parse(r),a=\"object\"==o(s)&&-1!==[\"pending\",\"acknowledged\",\"rejected\"].indexOf(s.state)&&(void 0===s.error||\"object\"==o(s.error));return a&&s.error&&(a=\"string\"==typeof s.error.message&&\"string\"==typeof s.error.code)&&(i=new u(s.error.code,s.error.message)),a?new t(e,n,s.state,i):(l(\"SharedClientState\",\"Failed to parse mutation state for ID '\"+n+\"': \"+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Xi=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),s=\"object\"==o(i)&&-1!==[\"not-current\",\"current\",\"rejected\"].indexOf(i.state)&&(void 0===i.error||\"object\"==o(i.error));return s&&i.error&&(s=\"string\"==typeof i.error.message&&\"string\"==typeof i.error.code)&&(r=new u(i.error.code,i.error.message)),s?new t(e,i.state,r):(l(\"SharedClientState\",\"Failed to parse target state for ID '\"+e+\"': \"+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Ji=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i=\"object\"==o(r)&&r.activeTargetIds instanceof Array,s=je(),a=0;i&&a<r.activeTargetIds.length;++a)i=K(r.activeTargetIds[a]),s=s.add(r.activeTargetIds[a]);return i?new t(e,s):(l(\"SharedClientState\",\"Failed to parse client data for instance '\"+e+\"': \"+n),null)},t}(),Zi=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return\"object\"==o(n)&&-1!==[\"Unknown\",\"Online\",\"Offline\"].indexOf(n.onlineState)&&\"string\"==typeof n.clientId?new t(n.clientId,n.onlineState):(l(\"SharedClientState\",\"Failed to parse online state: \"+e),null)},t}(),to=function(){function t(){this.activeTargetIds=je()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),eo=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new Ae(w),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\\]\\\\]/g,\"\\\\$&\");this.storage=this.window.localStorage,this.currentUser=i,this.Os=Wi(this.persistenceKey,this.Ns),this.Ms=function(t){return\"firestore_sequence_number_\"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new to),this.Ls=new RegExp(\"^firestore_clients_\"+o+\"_([^_]*)$\"),this.Bs=new RegExp(\"^firestore_mutations_\"+o+\"_(\\\\d+)(?:_(.*))?$\"),this.qs=new RegExp(\"^firestore_targets_\"+o+\"_(\\\\d+)$\"),this.Us=function(t){return\"firestore_online_state_\"+t}(this.persistenceKey),this.Ks=function(t){return\"firestore_bundle_loaded_\"+t}(this.persistenceKey),this.window.addEventListener(\"storage\",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t,n,r,i,o,s,a,u,c,h,f,l=this;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=e.sent(),n=0,r=t;n<r.length;n++)(i=r[n])!==this.Ns&&(o=this.getItem(Wi(this.persistenceKey,i)))&&(s=Ji.Vs(i,o))&&(this.ks=this.ks.insert(s.clientId,s));for(this.Qs(),(a=this.storage.getItem(this.Us))&&(u=this.js(a))&&this.Ws(u),c=0,h=this.$s;c<h.length;c++)f=h[c],this.Fs(f);return this.$s=[],this.window.addEventListener(\"pagehide\",function(){return l.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.addPendingMutation=function(t){this.zs(t,\"pending\")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e=\"not-current\";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(Yi(this.persistenceKey,t));if(n){var r=Xi.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Qs(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(Yi(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener(\"storage\",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return f(\"SharedClientState\",\"READ\",t,e),e},t.prototype.setItem=function(t,e){f(\"SharedClientState\",\"SET\",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){f(\"SharedClientState\",\"REMOVE\",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var n=this,r=t;if(r.storageArea===this.storage){if(f(\"SharedClientState\",\"EVENT\",r.key,r.newValue),r.key===this.Os)return void l(\"Received WebStorage notification for local change. Another client might have garbage-collected our state\");this.Se.enqueueRetryable(function(){return(0,e.__awaiter)(n,void 0,void 0,function(){var t,n,i,o,a,u;return(0,e.__generator)(this,function(e){if(this.started){if(null!==r.key)if(this.Ls.test(r.key)){if(null==r.newValue)return t=this.ti(r.key),[2,this.ei(t,null)];if(n=this.ni(r.key,r.newValue))return[2,this.ei(n.clientId,n)]}else if(this.Bs.test(r.key)){if(null!==r.newValue&&(i=this.si(r.key,r.newValue)))return[2,this.ii(i)]}else if(this.qs.test(r.key)){if(null!==r.newValue&&(o=this.ri(r.key,r.newValue)))return[2,this.oi(o)]}else if(r.key===this.Us){if(null!==r.newValue&&(a=this.js(r.newValue)))return[2,this.Ws(a)]}else if(r.key===this.Ms)(u=function(t){var e=s.o;if(null!=t)try{var n=JSON.parse(t);v(\"number\"==typeof n),e=n}catch(t){l(\"SharedClientState\",\"Failed to read sequence number from WebStorage\",t)}return e}(r.newValue))!==s.o&&this.sequenceNumberHandler(u);else if(r.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(r);return[2]})})})}},Object.defineProperty(t.prototype,\"Js\",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new $i(this.currentUser,t,e,n),i=Hi(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=Hi(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){var e={clientId:this.Ns,onlineState:t};this.storage.setItem(this.Us,JSON.stringify(e))},t.prototype.Ys=function(t,e,n){var r=Yi(this.persistenceKey,t),i=new Xi(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Ks,\"value-not-used\")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return Ji.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return $i.Vs(new zi(i),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return Xi.Vs(r,e)},t.prototype.js=function(t){return Zi.Vs(t)},t.prototype.ii=function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(f(\"SharedClientState\",\"Ignoring mutation for non-active user \"+t.user.uid),[2])})})},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.hi(s,a).then(function(){n.ks=r})},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=je();return t.forEach(function(t,n){e=e.unionWith(n.activeTargetIds)}),e},t}(),no=function(){function t(){this.li=new to,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||\"not-current\"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new to,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),ro=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),io=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener(\"online\",this.wi),window.removeEventListener(\"offline\",this.mi)},t.prototype.pi=function(){window.addEventListener(\"online\",this.wi),window.addEventListener(\"offline\",this.mi)},t.prototype._i=function(){f(\"ConnectivityMonitor\",\"Network connectivity changed: AVAILABLE\");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){f(\"ConnectivityMonitor\",\"Network connectivity changed: UNAVAILABLE\");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return\"undefined\"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),oo={BatchGetDocuments:\"batchGet\",Commit:\"commit\",RunQuery:\"runQuery\"},so=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),ao=function(t){function r(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return(0,e.__extends)(r,t),r.prototype.ki=function(t,e,n,r){return new Promise(function(o,s){var c=new i.XhrIo;c.listenOnce(i.EventType.COMPLETE,function(){try{switch(c.getLastErrorCode()){case i.ErrorCode.NO_ERROR:var e=c.getResponseJson();f(\"Connection\",\"XHR received:\",JSON.stringify(e)),o(e);break;case i.ErrorCode.TIMEOUT:f(\"Connection\",'RPC \"'+t+'\" timed out'),s(new u(a.DEADLINE_EXCEEDED,\"Request time out\"));break;case i.ErrorCode.HTTP_ERROR:var n=c.getStatus();if(f(\"Connection\",'RPC \"'+t+'\" failed with status:',n,\"response text:\",c.getResponseText()),n>0){var r=c.getResponseJson().error;if(r&&r.status&&r.message){var h=function(t){var e=r.status.toLowerCase().replace(/_/g,\"-\");return Object.values(a).indexOf(e)>=0?e:a.UNKNOWN}();s(new u(h,r.message))}else s(new u(a.UNKNOWN,\"Server responded with status \"+c.getStatus()))}else s(new u(a.UNAVAILABLE,\"Connection failed.\"));break;default:y()}}finally{f(\"Connection\",'RPC \"'+t+'\" completed.')}});var h=JSON.stringify(r);c.send(e,\"POST\",h,n,15)})},r.prototype.Oi=function(t,e){var r=[this.Di,\"/\",\"google.firestore.v1.Firestore\",\"/\",t,\"/channel\"],o=(0,i.createWebChannelTransport)(),s=(0,i.getStatEventTarget)(),c={httpSessionIdParam:\"gsessionid\",initMessageHeaders:{},messageUrlParams:{database:\"projects/\"+this.databaseId.projectId+\"/databases/\"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(c.xmlHttpFactory=new i.FetchXmlHttpFactory({})),this.Fi(c.initMessageHeaders,e),(0,n.isMobileCordova)()||(0,n.isReactNative)()||(0,n.isElectron)()||(0,n.isIE)()||(0,n.isUWP)()||(0,n.isBrowserExtension)()||(c.httpHeadersOverwriteParam=\"$httpHeaders\");var h=r.join(\"\");f(\"Connection\",\"Creating WebChannel: \"+h,c);var l=o.createWebChannel(h,c),p=!1,y=!1,m=new so({Ei:function(t){y?f(\"Connection\",\"Not sending because WebChannel is closed:\",t):(p||(f(\"Connection\",\"Opening WebChannel transport.\"),l.open(),p=!0),f(\"Connection\",\"WebChannel sending:\",t),l.send(t))},Ti:function(){return l.close()}}),g=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return g(l,i.WebChannel.EventType.OPEN,function(){y||f(\"Connection\",\"WebChannel transport opened.\")}),g(l,i.WebChannel.EventType.CLOSE,function(){y||(y=!0,f(\"Connection\",\"WebChannel transport closed\"),m.Vi())}),g(l,i.WebChannel.EventType.ERROR,function(t){y||(y=!0,d(\"Connection\",\"WebChannel transport errored:\",t),m.Vi(new u(a.UNAVAILABLE,\"The operation could not be completed\")))}),g(l,i.WebChannel.EventType.MESSAGE,function(t){var e;if(!y){var n=t.data[0];v(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){f(\"Connection\",\"WebChannel received error:\",i);var o=i.status,s=function(t){var e=be[o];if(void 0!==e)return De(e)}(),c=i.message;void 0===s&&(s=a.INTERNAL,c=\"Unknown error status: \"+o+\" with message \"+i.message),y=!0,m.Vi(new u(s,c)),l.close()}else f(\"Connection\",\"WebChannel received:\",n),m.Si(n)}}),g(s,i.Event.STAT_EVENT,function(t){t.stat===i.Stat.PROXY?f(\"Connection\",\"Detected buffering proxy\"):t.stat===i.Stat.NOPROXY&&f(\"Connection\",\"Detected no buffering proxy\")}),setTimeout(function(){m.Pi()},0),m},r}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?\"https\":\"http\";this.Di=e+\"://\"+t.host,this.Ci=\"projects/\"+this.databaseId.projectId+\"/databases/\"+this.databaseId.database+\"/documents\"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);f(\"RestConnection\",\"Sending: \",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then(function(t){return f(\"RestConnection\",\"Received: \",t),t},function(e){throw d(\"RestConnection\",t+\" failed with error: \",e,\"url: \",i,\"request:\",n),e})},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t[\"X-Goog-Api-Client\"]=\"gl-js/ fire/8.7.0\",t[\"Content-Type\"]=\"text/plain\",this.databaseInfo.appId&&(t[\"X-Firebase-GMPID\"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){var n=oo[t];return this.Di+\"/v1/\"+e+\":\"+n},t}());function uo(){return\"undefined\"!=typeof window?window:null}function co(){return\"undefined\"!=typeof document?document:null}function ho(t){return new tn(t,!0)}var fo=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Qi=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);i>0&&f(\"ExponentialBackoff\",\"Backing off for \"+i+\" ms (base delay: \"+this.qi+\" ms, delay with jitter: \"+n+\" ms, last attempt: \"+r+\" ms ago)\"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Ki=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),lo=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new fo(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():n&&n.code===a.RESOURCE_EXHAUSTED?(l(n.toString()),l(\"Using maximum backoff delay to prevent overloading the backend.\"),this.Zi.Qi()):n&&n.code===a.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(n)];case 1:return e.sent(),[2]}})})},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(e){t.Yi===n&&t.lr(e)},function(n){e(function(){var e=new u(a.UNKNOWN,\"Fetching auth token failed: \"+n.message);return t.dr(e)})})},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return(0,e.__awaiter)(t,void 0,void 0,function(){return(0,e.__generator)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.dr=function(t){return f(\"PersistentStream\",\"close with error: \"+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget(function(){return e.Yi===t?n():(f(\"PersistentStream\",\"stream callback skipped by getCloseGuardedDispatcher.\"),Promise.resolve())})}},t}(),po=function(t){function n(e,n,r,i,o){var s=this;return(s=t.call(this,e,\"listen_stream_connection_backoff\",\"listen_stream_idle\",n,r,o)||this).R=i,s}return(0,e.__extends)(n,t),n.prototype.wr=function(t){return this.Hi.Oi(\"Listen\",t)},n.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if(\"targetChange\"in e){e.targetChange;var r=function(t){return\"NO_CHANGE\"===t?0:\"ADD\"===t?1:\"REMOVE\"===t?2:\"CURRENT\"===t?3:\"RESET\"===t?4:y()}(e.targetChange.targetChangeType||\"NO_CHANGE\"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(v(void 0===e||\"string\"==typeof e),L.fromBase64String(e||\"\")):(v(void 0===e||e instanceof Uint8Array),L.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(c=e.targetChange.cause)&&function(t){var e=void 0===t.code?a.UNKNOWN:De(t.code);return new u(e,t.message||\"\")}(c);n=new We(r,i,o,s||null)}else if(\"documentChange\"in e){e.documentChange,(r=e.documentChange).document,r.document.name,r.document.updateTime,i=cn(t,r.document.name),o=on(r.document.updateTime);var c=new ot({mapValue:{fields:r.document.fields}}),h=(s=at.newFoundDocument(i,o,c),r.targetIds||[]),f=r.removedTargetIds||[];n=new Ge(h,f,s.key,s)}else if(\"documentDelete\"in e)e.documentDelete,(r=e.documentDelete).document,i=cn(t,r.document),o=r.readTime?on(r.readTime):T.min(),c=at.newNoDocument(i,o),s=r.removedTargetIds||[],n=new Ge([],s,c.key,c);else if(\"documentRemove\"in e)e.documentRemove,(r=e.documentRemove).document,i=cn(t,r.document),o=r.removedTargetIds||[],n=new Ge([],o,i,null);else{if(!(\"filter\"in e))return y();e.filter;var l=e.filter;l.targetId,r=l.count||0,i=new Se(r),o=l.targetId,n=new ze(o,i)}return n}(this.R,t),n=function(t){if(!(\"targetChange\"in t))return T.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?T.min():e.readTime?on(e.readTime):T.min()}(t);return this.listener._r(e,n)},n.prototype.mr=function(t){var e={};e.database=ln(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=lt(r)?{documents:gn(t,r)}:{query:_n(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=nn(t,e.resumeToken):e.snapshotVersion.compareTo(T.min())>0&&(n.readTime=en(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return\"existence-filter-mismatch\";case 2:return\"limbo-document\";default:return y()}}(0,e.purpose);return null==n?null:{\"goog-listen-tags\":n}}(this.R,t);n&&(e.labels=n),this.cr(e)},n.prototype.yr=function(t){var e={};e.database=ln(this.R),e.removeTarget=t,this.cr(e)},n}(lo),yo=function(t){function n(e,n,r,i,o){var s=this;return(s=t.call(this,e,\"write_stream_connection_backoff\",\"write_stream_idle\",n,r,o)||this).R=i,s.gr=!1,s}return(0,e.__extends)(n,t),Object.defineProperty(n.prototype,\"pr\",{get:function(){return this.gr},enumerable:!1,configurable:!0}),n.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},n.prototype.ar=function(){this.gr&&this.Er([])},n.prototype.wr=function(t){return this.Hi.Oi(\"Write\",t)},n.prototype.onMessage=function(t){if(v(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(v(void 0!==e),t.map(function(t){return function(t,e){var n=t.updateTime?on(t.updateTime):on(e);return n.isEqual(T.min())&&(n=on(e)),new ae(n,t.transformResults||[])}(t,e)})):[]}(t.writeResults,t.commitTime),n=on(t.commitTime);return this.listener.Tr(n,e)}return v(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},n.prototype.Ar=function(){var t={};t.database=ln(this.R),this.cr(t)},n.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return vn(e.R,t)})};this.cr(n)},n}(lo),vo=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return(0,e.__extends)(n,t),n.prototype.br=function(){if(this.Rr)throw new u(a.FAILED_PRECONDITION,\"The client has already been terminated.\")},n.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(t,e,n,i)}).catch(function(t){throw\"FirebaseError\"===t.name?(t.code===a.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new u(a.UNKNOWN,t.toString())})},n.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.$i(t,e,n,i)}).catch(function(t){throw\"FirebaseError\"===t.name?(t.code===a.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new u(a.UNKNOWN,t.toString())})},n.prototype.terminate=function(){this.Rr=!0},n}(function(){}),mo=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=\"Unknown\",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr(\"Unknown\"),this.Pr=this.asyncQueue.enqueueAfterDelay(\"online_state_timeout\",1e4,function(){return t.Pr=null,t.Cr(\"Backend didn't respond within 10 seconds.\"),t.Dr(\"Offline\"),Promise.resolve()}))},t.prototype.Nr=function(t){\"Online\"===this.state?this.Dr(\"Unknown\"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr(\"Connection failed 1 times. Most recent error: \"+t.toString()),this.Dr(\"Offline\")))},t.prototype.set=function(t){this.Fr(),this.vr=0,\"Online\"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e=\"Could not reach Cloud Firestore backend. \"+t+\"\\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.\";this.Vr?(l(e),this.Vr=!1):f(\"OnlineStateTracker\",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),go=function(t,n,r,i,o){var s=this;this.localStore=t,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.kr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=o,this.Lr.di(function(t){r.enqueueAndForget(function(){return(0,e.__awaiter)(s,void 0,void 0,function(){return(0,e.__generator)(this,function(t){switch(t.label){case 0:return Do(this)?(f(\"RemoteStore\",\"Restarting streams for network reachability change.\"),[4,function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return(n=m(t)).Or.add(4),[4,wo(n)];case 1:return e.sent(),n.Br.set(\"Unknown\"),n.Or.delete(4),[4,_o(n)];case 2:return e.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new mo(r,i)};function _o(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n,r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:if(!Do(t))return[3,4];n=0,r=t.Mr,e.label=1;case 1:return n<r.length?[4,(0,r[n])(!0)]:[3,4];case 2:e.sent(),e.label=3;case 3:return n++,[3,1];case 4:return[2]}})})}function wo(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n,r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:n=0,r=t.Mr,e.label=1;case 1:return n<r.length?[4,(0,r[n])(!1)]:[3,4];case 2:e.sent(),e.label=3;case 3:return n++,[3,1];case 4:return[2]}})})}function bo(t,e){var n=m(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),No(n)?So(n):jo(n).er()&&Eo(n,e))}function Io(t,e){var n=m(t),r=jo(n);n.$r.delete(e),r.er()&&To(n,e),0===n.$r.size&&(r.er()?r.ir():Do(n)&&n.Br.set(\"Unknown\"))}function Eo(t,e){t.qr.U(e.targetId),jo(t).mr(e)}function To(t,e){t.qr.U(e),jo(t).yr(e)}function So(t){t.qr=new Ye({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),jo(t).start(),t.Br.Sr()}function No(t){return Do(t)&&!jo(t).tr()&&t.$r.size>0}function Do(t){return 0===m(t).Or.size}function Ao(t){t.qr=void 0}function xo(t){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){return t.$r.forEach(function(e,n){Eo(t,e)}),[2]})})}function ko(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){return Ao(t),No(t)?(t.Br.Nr(n),So(t)):t.Br.set(\"Unknown\"),[2]})})}function Co(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s;return(0,e.__generator)(this,function(a){switch(a.label){case 0:if(t.Br.set(\"Online\"),!(n instanceof We&&2===n.state&&n.cause))return[3,6];a.label=1;case 1:return a.trys.push([1,3,,5]),[4,function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s;return(0,e.__generator)(this,function(e){switch(e.label){case 0:r=n.cause,i=0,o=n.targetIds,e.label=1;case 1:return i<o.length?(s=o[i],t.$r.has(s)?[4,t.remoteSyncer.rejectListen(s,r)]:[3,3]):[3,5];case 2:e.sent(),t.$r.delete(s),t.qr.removeTarget(s),e.label=3;case 3:e.label=4;case 4:return i++,[3,1];case 5:return[2]}})})}(t,n)];case 2:return a.sent(),[3,5];case 3:return i=a.sent(),f(\"RemoteStore\",\"Failed to remove targets %s: %s \",n.targetIds.join(\",\"),i),[4,Ro(t,i)];case 4:return a.sent(),[3,5];case 5:return[3,13];case 6:if(n instanceof Ge?t.qr.X(n):n instanceof ze?t.qr.rt(n):t.qr.et(n),r.isEqual(T.min()))return[3,13];a.label=7;case 7:return a.trys.push([7,11,,13]),[4,Ti(t.localStore)];case 8:return o=a.sent(),r.compareTo(o)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(L.EMPTY_BYTE_STRING,n.snapshotVersion)),To(t,e);var r=new vr(n.target,e,1,n.sequenceNumber);Eo(t,r)}}),t.remoteSyncer.applyRemoteEvent(n)}(t,r)]:[3,10];case 9:a.sent(),a.label=10;case 10:return[3,13];case 11:return f(\"RemoteStore\",\"Failed to raise snapshot:\",s=a.sent()),[4,Ro(t,s)];case 12:return a.sent(),[3,13];case 13:return[2]}})})}function Ro(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i=this;return(0,e.__generator)(this,function(o){switch(o.label){case 0:if(!ar(n))throw n;return t.Or.add(1),[4,wo(t)];case 1:return o.sent(),t.Br.set(\"Offline\"),r||(r=function(){return Ti(t.localStore)}),t.asyncQueue.enqueueRetryable(function(){return(0,e.__awaiter)(i,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return f(\"RemoteStore\",\"Retrying IndexedDB access\"),[4,r()];case 1:return e.sent(),t.Or.delete(1),[4,_o(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function Lo(t,e){return e().catch(function(n){return Ro(t,n,e)})}function Oo(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n,r,i,o,s;return(0,e.__generator)(this,function(e){switch(e.label){case 0:n=m(t),r=Ko(n),i=n.kr.length>0?n.kr[n.kr.length-1].batchId:-1,e.label=1;case 1:if(!function(t){return Do(t)&&t.kr.length<10}(n))return[3,7];e.label=2;case 2:return e.trys.push([2,4,,6]),[4,Di(n.localStore,i)];case 3:return null===(o=e.sent())?(0===n.kr.length&&r.ir(),[3,7]):(i=o.batchId,function(t,e){t.kr.push(e);var n=Ko(t);n.er()&&n.pr&&n.Er(e.mutations)}(n,o),[3,6]);case 4:return s=e.sent(),[4,Ro(n,s)];case 5:return e.sent(),[3,6];case 6:return[3,1];case 7:return Po(n)&&Mo(n),[2]}})})}function Po(t){return Do(t)&&!Ko(t).tr()&&t.kr.length>0}function Mo(t){Ko(t).start()}function Fo(t){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){return Ko(t).Ar(),[2]})})}function Vo(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n,r,i,o;return(0,e.__generator)(this,function(e){for(n=Ko(t),r=0,i=t.kr;r<i.length;r++)o=i[r],n.Er(o.mutations);return[2]})})}function qo(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return i=t.kr.shift(),o=yr.from(i,n,r),[4,Lo(t,function(){return t.remoteSyncer.applySuccessfulWrite(o)})];case 1:return e.sent(),[4,Oo(t)];case 2:return e.sent(),[2]}})})}function Uo(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(r){switch(r.label){case 0:return n&&Ko(t).pr?[4,function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return Ne(i=n.code)&&i!==a.ABORTED?(r=t.kr.shift(),Ko(t).sr(),[4,Lo(t,function(){return t.remoteSyncer.rejectFailedWrite(r.batchId,n)})]):[3,3];case 1:return e.sent(),[4,Oo(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})}(t,n)]:[3,2];case 1:r.sent(),r.label=2;case 2:return Po(t)&&Mo(t),[2]}})})}function Bo(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r=m(t),n?(r.Or.delete(2),[4,_o(r)]):[3,2];case 1:return e.sent(),[3,5];case 2:return n?[3,4]:(r.Or.add(2),[4,wo(r)]);case 3:e.sent(),r.Br.set(\"Unknown\"),e.label=4;case 4:e.label=5;case 5:return[2]}})})}function jo(t){var n=this;return t.Ur||(t.Ur=function(t,e,n){var r=m(t);return r.br(),new po(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:xo.bind(null,t),Ri:ko.bind(null,t),_r:Co.bind(null,t)}),t.Mr.push(function(r){return(0,e.__awaiter)(n,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r?(t.Ur.sr(),No(t)?So(t):t.Br.set(\"Unknown\"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),Ao(t),e.label=3;case 3:return[2]}})})})),t.Ur}function Ko(t){var n=this;return t.Kr||(t.Kr=function(t,e,n){var r=m(t);return r.br(),new yo(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Fo.bind(null,t),Ri:Uo.bind(null,t),Ir:Vo.bind(null,t),Tr:qo.bind(null,t)}),t.Mr.push(function(r){return(0,e.__awaiter)(n,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r?(t.Kr.sr(),[4,Oo(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Kr.stop()];case 3:e.sent(),t.kr.length>0&&(f(\"RemoteStore\",\"Stopping write stream with \"+t.kr.length+\" pending writes\"),t.kr=[]),e.label=4;case 4:return[2]}})})})),t.Kr}var Qo=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new er,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new u(a.CANCELLED,\"Operation cancelled\"+(t?\": \"+t:\"\"))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function Go(t,e){if(l(\"AsyncQueue\",e+\": \"+t),ar(t))return new u(a.UNAVAILABLE,e+\": \"+t);throw t}var zo=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||Q.comparator(e.key,n.key)}:function(t,e){return Q.comparator(t.key,e.key)},this.keyedMap=Me(),this.sortedSet=new Ae(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,\"size\",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?\"DocumentSet ()\":\"DocumentSet (\\n  \"+t.join(\"  \\n\")+\"\\n)\"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),Wo=function(){function t(){this.Qr=new Ae(Q.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);n?0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):y():this.Qr=this.Qr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal(function(e,n){t.push(n)}),t},t}(),Ho=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,zo.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,\"hasPendingWrites\",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&qt(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Yo=function(){this.Wr=void 0,this.listeners=[]},$o=function(){this.queries=new ni(function(t){return Ut(t)},qt),this.onlineState=\"Unknown\",this.Gr=new Set};function Xo(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,a,u,c;return(0,e.__generator)(this,function(e){switch(e.label){case 0:if(r=m(t),i=n.query,o=!1,(s=r.queries.get(i))||(o=!0,s=new Yo),!o)return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),a=s,[4,r.onListen(i)];case 2:return a.Wr=e.sent(),[3,4];case 3:return u=e.sent(),c=Go(u,\"Initialization of query '\"+Bt(n.query)+\"' failed\"),[2,void n.onError(c)];case 4:return r.queries.set(i,s),s.listeners.push(n),n.zr(r.onlineState),s.Wr&&n.Hr(s.Wr)&&es(r),[2]}})})}function Jo(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,a;return(0,e.__generator)(this,function(e){return r=m(t),i=n.query,o=!1,(s=r.queries.get(i))&&(a=s.listeners.indexOf(n))>=0&&(s.listeners.splice(a,1),o=0===s.listeners.length),o?[2,(r.queries.delete(i),r.onUnlisten(i))]:[2]})})}function Zo(t,e){for(var n=m(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query,u=n.queries.get(a);if(u){for(var c=0,h=u.listeners;c<h.length;c++)h[c].Hr(s)&&(r=!0);u.Wr=s}}r&&es(n)}function ts(t,e,n){var r=m(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function es(t){t.Gr.forEach(function(t){t.next()})}var ns=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState=\"Unknown\",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Ho(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){if(!t.fromCache)return!0;var n=\"Offline\"!==e;return!(this.options.so&&n||t.docs.isEmpty()&&\"Offline\"!==e)},t.prototype.Zr=function(t){if(t.docChanges.length>0)return!0;var e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=Ho.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),rs=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return\"metadata\"in this.payload},t}(),is=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return cn(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?yn(this.R,t.document,!1):at.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},t.prototype.Kn=function(t){return on(t)},t}(),os=function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=ss(t)}return t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new is(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||Ue()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t,n,r,i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,Oi(this.localStore,new is(this.R),this.documents,this.ro.id)];case 1:t=e.sent(),n=this.co(this.documents),r=0,i=this.queries,e.label=2;case 2:return r<i.length?(o=i[r],[4,Pi(this.localStore,o,n.get(o.name))]):[3,5];case 3:e.sent(),e.label=4;case 4:return r++,[3,2];case 5:return[2,(this.progress.taskState=\"Success\",new vi(Object.assign({},this.progress),t))]}})})},t}();function ss(t){return{taskState:\"Running\",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var as=function(t){this.key=t},us=function(t){this.key=t},cs=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=Ue(),this.mutatedKeys=Ue(),this.lo=Kt(t),this.fo=new zo(this.lo)}return Object.defineProperty(t.prototype,\"wo\",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new Wo,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=Ct(this.query)&&i.size===this.query.limit?i.last():null,c=Rt(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var h=i.get(t),f=jt(n.query,e)?e:null,l=!!h&&n.mutatedKeys.has(h.key),d=!!f&&(f.hasLocalMutations||n.mutatedKeys.has(f.key)&&f.hasCommittedMutations),p=!1;h&&f?h.data.isEqual(f.data)?l!==d&&(r.track({type:3,doc:f}),p=!0):n.yo(h,f)||(r.track({type:2,doc:f}),p=!0,(u&&n.lo(f,u)>0||c&&n.lo(f,c)<0)&&(a=!0)):!h&&f?(r.track({type:0,doc:f}),p=!0):h&&!f&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(f?(s=s.add(f),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),Ct(this.query)||Rt(this.query))for(;s.size>this.query.limit;){var h=Ct(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return y()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)}),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new Ho(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&\"Offline\"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Wo,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=Ue(),this.fo.forEach(function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))});var n=[];return e.forEach(function(e){t.ho.has(e)||n.push(new us(e))}),this.ho.forEach(function(t){e.has(t)||n.push(new as(t))}),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=Ue();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return Ho.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),hs=function(t,e,n){this.query=t,this.targetId=e,this.view=n},fs=function(t){this.key=t,this.bo=!1},ls=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new ni(function(t){return Ut(t)},qt),this.Vo=new Map,this.So=new Set,this.Do=new Ae(Q.comparator),this.Co=new Map,this.No=new Fi,this.xo={},this.Fo=new Map,this.ko=Qr.Yt(),this.onlineState=\"Unknown\",this.$o=void 0}return Object.defineProperty(t.prototype,\"isPrimaryClient\",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function ds(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,a,u;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r=js(t),(s=r.Po.get(n))?(i=s.targetId,r.sharedClientState.addLocalQueryTarget(i),o=s.view.Ro(),[3,4]):[3,1];case 1:return[4,Ai(r.localStore,Ft(n))];case 2:return a=e.sent(),u=r.sharedClientState.addLocalQueryTarget(a.targetId),i=a.targetId,[4,ps(r,n,i,\"current\"===u)];case 3:o=e.sent(),r.isPrimaryClient&&bo(r.remoteStore,a),e.label=4;case 4:return[2,o]}})})}function ps(t,n,r,i){return(0,e.__awaiter)(this,void 0,void 0,function(){var o,s,a,u,c,h;return(0,e.__generator)(this,function(f){switch(f.label){case 0:return t.Oo=function(n,r,i){return function(t,n,r,i){return(0,e.__awaiter)(this,void 0,void 0,function(){var o,s,a;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return(o=n.view._o(r)).Nn?[4,ki(t.localStore,n.query,!1).then(function(t){var e=t.documents;return n.view._o(e,o)})]:[3,2];case 1:o=e.sent(),e.label=2;case 2:return s=i&&i.targetChanges.get(n.targetId),a=n.view.applyChanges(o,t.isPrimaryClient,s),[2,(Ds(t,n.targetId,a.To),a.snapshot)]}})})}(t,n,r,i)},[4,ki(t.localStore,n,!0)];case 1:return o=f.sent(),s=new cs(n,o.Bn),a=s._o(o.documents),u=Qe.createSynthesizedTargetChangeForCurrentChange(r,i&&\"Offline\"!==t.onlineState),c=s.applyChanges(a,t.isPrimaryClient,u),Ds(t,r,c.To),h=new hs(n,r,s),[2,(t.Po.set(n,h),t.Vo.has(r)?t.Vo.get(r).push(n):t.Vo.set(r,[n]),c.snapshot)]}})})}function ys(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r=m(t),i=r.Po.get(n),(o=r.Vo.get(i.targetId)).length>1?[2,(r.Vo.set(i.targetId,o.filter(function(t){return!qt(t,n)})),void r.Po.delete(n))]:r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)?[3,2]:[4,xi(r.localStore,i.targetId,!1).then(function(){r.sharedClientState.clearQueryState(i.targetId),Io(r.remoteStore,i.targetId),Ss(r,i.targetId)}).catch(Yr)]):[3,3];case 1:e.sent(),e.label=2;case 2:return[3,5];case 3:return Ss(r,i.targetId),[4,xi(r.localStore,i.targetId,!0)];case 4:e.sent(),e.label=5;case 5:return[2]}})})}function vs(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s,a;return(0,e.__generator)(this,function(e){switch(e.label){case 0:i=Ks(t),e.label=1;case 1:return e.trys.push([1,5,,6]),[4,function(t,e){var n,r=m(t),i=E.now(),o=e.reduce(function(t,e){return t.add(e.key)},Ue());return r.persistence.runTransaction(\"Locally write mutations\",\"readwrite\",function(t){return r.Mn.pn(t,o).next(function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=de(c,n.get(c.key));null!=h&&s.push(new me(c.key,h,st(h.value.mapValue),ue.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)})}).then(function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}})}(i.localStore,n)];case 2:return o=e.sent(),i.sharedClientState.addPendingMutation(o.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Ae(w)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(i,o.batchId,r),[4,ks(i,o.changes)];case 3:return e.sent(),[4,Oo(i.remoteStore)];case 4:return e.sent(),[3,6];case 5:return s=e.sent(),a=Go(s,\"Failed to persist write\"),r.reject(a),[3,6];case 6:return[2]}})})}function ms(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i;return(0,e.__generator)(this,function(e){switch(e.label){case 0:r=m(t),e.label=1;case 1:return e.trys.push([1,4,,6]),[4,Si(r.localStore,n)];case 2:return i=e.sent(),n.targetChanges.forEach(function(t,e){var n=r.Co.get(e);n&&(v(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?n.bo=!0:t.modifiedDocuments.size>0?v(n.bo):t.removedDocuments.size>0&&(v(n.bo),n.bo=!1))}),[4,ks(r,i,n)];case 3:return e.sent(),[3,6];case 4:return[4,Yr(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}})})}function gs(t,e,n){var r=m(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach(function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=m(t);n.onlineState=e;var r=!1;n.queries.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)}),r&&es(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function _s(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s,a,u,c;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return(i=m(t)).sharedClientState.updateQueryState(n,\"rejected\",r),o=i.Co.get(n),(s=o&&o.key)?(a=(a=new Ae(Q.comparator)).insert(s,at.newNoDocument(s,T.min())),u=Ue().add(s),c=new Ke(T.min(),new Map,new Ce(w),a,u),[4,ms(i,c)]):[3,2];case 1:return e.sent(),i.Do=i.Do.remove(s),i.Co.delete(n),xs(i),[3,4];case 2:return[4,xi(i.localStore,n,!1).then(function(){return Ss(i,n,r)}).catch(Yr)];case 3:e.sent(),e.label=4;case 4:return[2]}})})}function ws(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:r=m(t),i=n.batch.batchId,e.label=1;case 1:return e.trys.push([1,4,,6]),[4,Ei(r.localStore,n)];case 2:return o=e.sent(),Ts(r,i,null),Es(r,i),r.sharedClientState.updateMutationState(i,\"acknowledged\"),[4,ks(r,o)];case 3:return e.sent(),[3,6];case 4:return[4,Yr(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}})})}function bs(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:i=m(t),e.label=1;case 1:return e.trys.push([1,4,,6]),[4,function(t,e){var n=m(t);return n.persistence.runTransaction(\"Reject batch\",\"readwrite-primary\",function(t){var r;return n._n.lookupMutationBatch(t,e).next(function(e){return v(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}(i.localStore,n)];case 2:return o=e.sent(),Ts(i,n,r),Es(i,n),i.sharedClientState.updateMutationState(n,\"rejected\",r),[4,ks(i,o)];case 3:return e.sent(),[3,6];case 4:return[4,Yr(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}})})}function Is(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,a;return(0,e.__generator)(this,function(e){switch(e.label){case 0:Do((r=m(t)).remoteStore)||f(\"SyncEngine\",\"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.\"),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,function(t){var e=m(r.localStore);return e.persistence.runTransaction(\"Get highest unacknowledged batch id\",\"readonly\",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})}()];case 2:return-1===(i=e.sent())?[2,void n.resolve()]:((o=r.Fo.get(i)||[]).push(n),r.Fo.set(i,o),[3,4]);case 3:return s=e.sent(),a=Go(s,\"Initialization of waitForPendingWrites() operation failed\"),n.reject(a),[3,4];case 4:return[2]}})})}function Es(t,e){(t.Fo.get(e)||[]).forEach(function(t){t.resolve()}),t.Fo.delete(e)}function Ts(t,e,n){var r=m(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function Ss(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(function(e){t.No.containsKey(e)||Ns(t,e)})}function Ns(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Io(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),xs(t))}function Ds(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof as?(t.No.addReference(o.key,e),As(t,o)):o instanceof us?(f(\"SyncEngine\",\"Document no longer in limbo: \"+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||Ns(t,o.key)):y()}}function As(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(f(\"SyncEngine\",\"New document in limbo: \"+n),t.So.add(r),xs(t))}function xs(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new Q(x.fromString(e)),r=t.ko.next();t.Co.set(r,new fs(n)),t.Do=t.Do.insert(n,r),bo(t.remoteStore,new vr(Ft(kt(n.path)),r,2,s.o))}}function ks(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s,a;return(0,e.__generator)(this,function(u){switch(u.label){case 0:return i=m(t),o=[],s=[],a=[],i.Po.isEmpty()?[3,3]:(i.Po.forEach(function(t,e){a.push(i.Oo(e,n,r).then(function(t){if(t){i.isPrimaryClient&&i.sharedClientState.updateQueryState(e.targetId,t.fromCache?\"not-current\":\"current\"),o.push(t);var n=gi.Pn(e.targetId,t);s.push(n)}}))}),[4,Promise.all(a)]);case 1:return u.sent(),i.vo._r(o),[4,function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h,l;return(0,e.__generator)(this,function(e){switch(e.label){case 0:r=m(t),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,r.persistence.runTransaction(\"notifyLocalViewChanges\",\"readwrite\",function(t){return nr.forEach(n,function(e){return nr.forEach(e.bn,function(n){return r.persistence.referenceDelegate.addReference(t,e.targetId,n)}).next(function(){return nr.forEach(e.vn,function(n){return r.persistence.referenceDelegate.removeReference(t,e.targetId,n)})})})})];case 2:return e.sent(),[3,4];case 3:if(!ar(i=e.sent()))throw i;return f(\"LocalStore\",\"Failed to update sequence numbers: \"+i),[3,4];case 4:for(o=0,s=n;o<s.length;o++)a=s[o],u=a.targetId,a.fromCache||(c=r.Fn.get(u),h=c.snapshotVersion,l=c.withLastLimboFreeSnapshotVersion(h),r.Fn=r.Fn.insert(u,l));return[2]}})})}(i.localStore,s)];case 2:u.sent(),u.label=3;case 3:return[2]}})})}function Cs(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return(r=m(t)).currentUser.isEqual(n)?[3,3]:(f(\"SyncEngine\",\"User change. New user:\",n.toKey()),[4,Ii(r.localStore,n)]);case 1:return i=e.sent(),r.currentUser=n,function(t,e){t.Fo.forEach(function(t){t.forEach(function(t){t.reject(new u(a.CANCELLED,\"'waitForPendingWrites' promise is rejected due to a user change.\"))})}),t.Fo.clear()}(r),r.sharedClientState.handleUserChange(n,i.removedBatchIds,i.addedBatchIds),[4,ks(r,i.Ln)];case 2:e.sent(),e.label=3;case 3:return[2]}})})}function Rs(t,e){var n=m(t),r=n.Co.get(e);if(r&&r.bo)return Ue().add(r.key);var i=Ue(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=a[s],c=n.Po.get(u);i=i.unionWith(c.view.wo)}return i}function Ls(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,ki((r=m(t)).localStore,n.query,!0)];case 1:return i=e.sent(),o=n.view.Ao(i),[2,(r.isPrimaryClient&&Ds(r,n.targetId,o.To),o)]}})})}function Os(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){return[2,Ri((n=m(t)).localStore).then(function(t){return ks(n,t)})]})})}function Ps(t,n,r,i){return(0,e.__awaiter)(this,void 0,void 0,function(){var o,s;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,function(t,e){var n=m(t),r=m(n._n);return n.persistence.runTransaction(\"Lookup mutation documents\",\"readonly\",function(t){return r.jt(t,e).next(function(e){return e?n.Mn.pn(t,e):nr.resolve(null)})})}((o=m(t)).localStore,n)];case 1:return null===(s=e.sent())?[3,6]:\"pending\"!==r?[3,3]:[4,Oo(o.remoteStore)];case 2:return e.sent(),[3,4];case 3:\"acknowledged\"===r||\"rejected\"===r?(Ts(o,n,i||null),Es(o,n),function(t,e){m(m(t)._n).Gt(e)}(o.localStore,n)):y(),e.label=4;case 4:return[4,ks(o,s)];case 5:return e.sent(),[3,7];case 6:f(\"SyncEngine\",\"Cannot apply mutation batch with id: \"+n),e.label=7;case 7:return[2]}})})}function Ms(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return js(r=m(t)),Ks(r),!0!==n||!0===r.$o?[3,3]:(i=r.sharedClientState.getAllActiveQueryTargets(),[4,Fs(r,i.toArray())]);case 1:return o=e.sent(),r.$o=!0,[4,Bo(r.remoteStore,!0)];case 2:for(e.sent(),s=0,a=o;s<a.length;s++)u=a[s],bo(r.remoteStore,u);return[3,7];case 3:return!1!==n||!1===r.$o?[3,7]:(c=[],h=Promise.resolve(),r.Vo.forEach(function(t,e){r.sharedClientState.isLocalQueryTarget(e)?c.push(e):h=h.then(function(){return Ss(r,e),xi(r.localStore,e,!0)}),Io(r.remoteStore,e)}),[4,h]);case 4:return e.sent(),[4,Fs(r,c)];case 5:return e.sent(),function(t){var e=m(r);e.Co.forEach(function(t,n){Io(e.remoteStore,n)}),e.No.ts(),e.Co=new Map,e.Do=new Ae(Q.comparator)}(),r.$o=!1,[4,Bo(r.remoteStore,!1)];case 6:e.sent(),e.label=7;case 7:return[2]}})})}function Fs(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h,f,l,d,p,y,v;return(0,e.__generator)(this,function(e){switch(e.label){case 0:r=m(t),i=[],o=[],s=0,a=n,e.label=1;case 1:return s<a.length?(u=a[s],c=void 0,(h=r.Vo.get(u))&&0!==h.length?[4,Ai(r.localStore,Ft(h[0]))]:[3,7]):[3,13];case 2:c=e.sent(),f=0,l=h,e.label=3;case 3:return f<l.length?(d=l[f],p=r.Po.get(d),[4,Ls(r,p)]):[3,6];case 4:(y=e.sent()).snapshot&&o.push(y.snapshot),e.label=5;case 5:return f++,[3,3];case 6:return[3,11];case 7:return[4,Ci(r.localStore,u)];case 8:return v=e.sent(),[4,Ai(r.localStore,v)];case 9:return c=e.sent(),[4,ps(r,Vs(v),u,!1)];case 10:e.sent(),e.label=11;case 11:i.push(c),e.label=12;case 12:return s++,[3,1];case 13:return[2,(r.vo._r(o),i)]}})})}function Vs(t){return xt(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,\"F\",t.startAt,t.endAt)}function qs(t){var e=m(t);return m(m(e.localStore).persistence).fn()}function Us(t,n,r,i){return(0,e.__awaiter)(this,void 0,void 0,function(){var o,s,a;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return(o=m(t)).$o?(f(\"SyncEngine\",\"Ignoring unexpected query state notification.\"),[3,8]):[3,1];case 1:if(!o.Vo.has(n))return[3,8];switch(r){case\"current\":case\"not-current\":return[3,2];case\"rejected\":return[3,5]}return[3,7];case 2:return[4,Ri(o.localStore)];case 3:return s=e.sent(),a=Ke.createSynthesizedRemoteEventForCurrentChange(n,\"current\"===r),[4,ks(o,s,a)];case 4:return e.sent(),[3,8];case 5:return[4,xi(o.localStore,n,!0)];case 6:return e.sent(),Ss(o,n,i),[3,8];case 7:y(),e.label=8;case 8:return[2]}})})}function Bs(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s,a,u,c,h,l,d,p;return(0,e.__generator)(this,function(y){switch(y.label){case 0:if(!(i=js(t)).$o)return[3,10];o=0,s=n,y.label=1;case 1:return o<s.length?(a=s[o],i.Vo.has(a)?(f(\"SyncEngine\",\"Adding an already active target \"+a),[3,5]):[4,Ci(i.localStore,a)]):[3,6];case 2:return u=y.sent(),[4,Ai(i.localStore,u)];case 3:return c=y.sent(),[4,ps(i,Vs(u),c.targetId,!1)];case 4:y.sent(),bo(i.remoteStore,c),y.label=5;case 5:return o++,[3,1];case 6:h=function(t){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return i.Vo.has(t)?[4,xi(i.localStore,t,!1).then(function(){Io(i.remoteStore,t),Ss(i,t)}).catch(Yr)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},l=0,d=r,y.label=7;case 7:return l<d.length?(p=d[l],[5,h(p)]):[3,10];case 8:y.sent(),y.label=9;case 9:return l++,[3,7];case 10:return[2]}})})}function js(t){var e=m(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=ms.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Rs.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=_s.bind(null,e),e.vo._r=Zo.bind(null,e.eventManager),e.vo.Mo=ts.bind(null,e.eventManager),e}function Ks(t){var e=m(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ws.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=bs.bind(null,e),e}function Qs(t,n,r){var i=m(t);(function(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s,a,u,c;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,14,,15]),[4,n.getMetadata()];case 1:return i=e.sent(),[4,function(t,e){var n=m(t),r=on(e.createTime);return n.persistence.runTransaction(\"hasNewerBundle\",\"readonly\",function(t){return n.Ke.getBundleMetadata(t,e.id)}).then(function(t){return!!t&&t.createTime.compareTo(r)>=0})}(t.localStore,i)];case 2:return e.sent()?[4,n.close()]:[3,4];case 3:return[2,(e.sent(),void r._completeWith(function(t){return{taskState:\"Success\",documentsLoaded:t.totalDocuments,bytesLoaded:t.totalBytes,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(i)))];case 4:return r._updateProgress(ss(i)),o=new os(i,t.localStore,n.R),[4,n.Lo()];case 5:s=e.sent(),e.label=6;case 6:return s?[4,o.oo(s)]:[3,10];case 7:return(a=e.sent())&&r._updateProgress(a),[4,n.Lo()];case 8:s=e.sent(),e.label=9;case 9:return[3,6];case 10:return[4,o.complete()];case 11:return u=e.sent(),[4,ks(t,u.wn,void 0)];case 12:return e.sent(),[4,function(t,e){var n=m(t);return n.persistence.runTransaction(\"Save bundle\",\"readwrite\",function(t){return n.Ke.saveBundleMetadata(t,e)})}(t.localStore,i)];case 13:return e.sent(),r._completeWith(u.progress),[3,15];case 14:return d(\"SyncEngine\",\"Loading bundle failed with \"+(c=e.sent())),r._failWith(c),[3,15];case 15:return[2]}})})})(i,n,r).then(function(){i.sharedClientState.notifyBundleLoaded()})}var Gs=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return this.R=ho(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}})})},t.prototype.Uo=function(t){return null},t.prototype.Ko=function(t){return bi(this.persistence,new _i,t.initialUser,this.R)},t.prototype.qo=function(t){return new Ki(Gi.bs,this.R)},t.prototype.Bo=function(t){return new no},t.prototype.terminate=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},t}(),zs=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).Qo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return(0,e.__extends)(n,t),n.prototype.initialize=function(n){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,t.prototype.initialize.call(this,n)];case 1:return e.sent(),[4,Li(this.localStore)];case 2:return e.sent(),[4,this.Qo.initialize(this,n)];case 3:return e.sent(),[4,Ks(this.Qo.syncEngine)];case 4:return e.sent(),[4,Oo(this.Qo.remoteStore)];case 5:return e.sent(),[2]}})})},n.prototype.Ko=function(t){return bi(this.persistence,new _i,t.initialUser,this.R)},n.prototype.Uo=function(t){var e=this.persistence.referenceDelegate.garbageCollector;return new Jr(e,t.asyncQueue)},n.prototype.qo=function(t){var e=yi(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Mr.withCacheSize(this.cacheSizeBytes):Mr.DEFAULT;return new li(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,uo(),co(),this.R,this.sharedClientState,!!this.forceOwnership)},n.prototype.Bo=function(t){return new no},n}(Gs),Ws=function(t){function n(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Qo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return(0,e.__extends)(n,t),n.prototype.initialize=function(n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i=this;return(0,e.__generator)(this,function(o){switch(o.label){case 0:return[4,t.prototype.initialize.call(this,n)];case 1:return o.sent(),r=this.Qo.syncEngine,this.sharedClientState instanceof eo?(this.sharedClientState.syncEngine={ui:Ps.bind(null,r),ai:Us.bind(null,r),hi:Bs.bind(null,r),fn:qs.bind(null,r),ci:Os.bind(null,r)},[4,this.sharedClientState.start()]):[3,3];case 2:o.sent(),o.label=3;case 3:return[4,this.persistence.He(function(t){return(0,e.__awaiter)(i,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,Ms(this.Qo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return o.sent(),[2]}})})},n.prototype.Bo=function(t){var e=uo();if(!eo.yt(e))throw new u(a.UNIMPLEMENTED,\"IndexedDB persistence is only available on platforms that support LocalStorage.\");var n=yi(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new eo(e,t.asyncQueue,n,t.clientId,t.initialUser)},n}(zs),Hs=function(){function t(){}return t.prototype.initialize=function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r=this;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return gs(r.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Cs.bind(null,this.syncEngine),[4,Bo(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.createEventManager=function(t){return new $o},t.prototype.createDatastore=function(t){var e,n=ho(t.databaseInfo.databaseId),r=(e=t.databaseInfo,new ao(e));return function(t,e,n){return new vo(t,r,n)}(t.credentials,0,n)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return gs(s.syncEngine,t,0)},o=io.yt()?new io:new ro,new go(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new ls(t,e,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return n=m(t),f(\"RemoteStore\",\"RemoteStore shutting down.\"),n.Or.add(5),[4,wo(n)];case 1:return e.sent(),n.Lr.shutdown(),n.Br.set(\"Unknown\"),[2]}})})}(this.remoteStore)},t}();function Ys(t,n){void 0===n&&(n=10240);var r=0;return{read:function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var i;return(0,e.__generator)(this,function(e){return r<t.byteLength?(i={value:t.slice(r,r+n),done:!1},[2,(r+=n,i)]):[2,{done:!0}]})})},cancel:function(){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(t){return[2]})})},releaseLock:function(){},closed:Promise.reject(\"unimplemented\")}}var $s=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error(\"Uncaught Error in snapshot listener:\",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),Xs=function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new er,this.buffer=new Uint8Array,this.zo=new TextDecoder(\"utf-8\"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error(\"The first element of the bundle is not a metadata, it is\\n             \"+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}return t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Lo=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},t.prototype.Ho=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t,n,r,i;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,this.Jo()];case 1:return null===(t=e.sent())?[2,null]:(n=this.zo.decode(t),r=Number(n),isNaN(r)&&this.Yo(\"length string (\"+n+\") is not valid number\"),[4,this.Xo(r)]);case 2:return i=e.sent(),[2,new rs(JSON.parse(i),t.length+r)]}})})},t.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t===\"{\".charCodeAt(0)})},t.prototype.Jo=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t,n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(e.sent())return[3,3];e.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo(\"Reached the end of bundle when a length string is expected.\"),n=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),n)])}})})},t.prototype.Xo=function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:e.sent()&&this.Yo(\"Reached the end of bundle when more is expected.\"),e.label=2;case 2:return[3,0];case 3:return n=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),n)]}})})},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error(\"Invalid bundle format: \"+t)},t.prototype.tc=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t,n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,this.Go.read()];case 1:return(t=e.sent()).done||((n=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),n.set(t.value,this.buffer.length),this.buffer=n),[2,t.done]}})})},t}(),Js=function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n,r=this;return(0,e.__generator)(this,function(i){switch(i.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new u(a.INVALID_ARGUMENT,\"Firestore transactions require all reads to be executed before all writes.\");return[4,function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,a,u;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r=m(t),i=ln(r.R)+\"/documents\",o={documents:n.map(function(t){return un(r.R,t)})},[4,r.$i(\"BatchGetDocuments\",i,o)];case 1:return s=e.sent(),a=new Map,s.forEach(function(t){var e=function(t,e){return\"found\"in e?function(t,e){v(!!e.found),e.found.name,e.found.updateTime;var n=cn(t,e.found.name),r=on(e.found.updateTime),i=new ot({mapValue:{fields:e.found.fields}});return at.newFoundDocument(n,r,i)}(t,e):\"missing\"in e?function(t,e){v(!!e.missing),v(!!e.readTime);var n=cn(t,e.missing),r=on(e.readTime);return at.newNoDocument(n,r)}(t,e):y()}(r.R,t);a.set(e.key.toString(),e)}),u=[],[2,(n.forEach(function(t){var e=a.get(t.toString());v(!!e),u.push(e)}),u)]}})})}(this.datastore,t)];case 1:return[2,((n=i.sent()).forEach(function(t){return r.recordVersion(t)}),n)]}})})},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new Ee(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t,n=this;return(0,e.__generator)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,e){var r=Q.fromPath(e);n.mutations.push(new Te(r,n.precondition(r)))}),[4,function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r=m(t),i=ln(r.R)+\"/documents\",o={writes:n.map(function(t){return vn(r.R,t)})},[4,r.Ni(\"Commit\",i,o)];case 1:return e.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return r.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw y();e=T.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new u(a.ABORTED,\"Document version changed between two reads.\")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?ue.updateTime(e):ue.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(T.min()))throw new u(a.INVALID_ARGUMENT,\"Can't update a document that doesn't exist.\");return ue.updateTime(e)}return ue.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}(),Zs=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new fo(this.asyncQueue,\"transaction_retry\")}return t.prototype.run=function(){this.ec-=1,this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji(function(){return(0,e.__awaiter)(t,void 0,void 0,function(){var t,n,r=this;return(0,e.__generator)(this,function(e){return t=new Js(this.datastore),(n=this.sc(t))&&n.then(function(e){r.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){r.deferred.resolve(e)}).catch(function(t){r.ic(t)})})}).catch(function(t){r.ic(t)}),[2]})})})},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!B(e)&&e.catch&&e.then?e:(this.deferred.reject(Error(\"Transaction callback must return a Promise\")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.rc=function(t){if(\"FirebaseError\"===t.name){var e=t.code;return\"aborted\"===e||\"failed-precondition\"===e||!Ne(e)}return!1},t}(),ta=function(){function t(t,n,r){var i=this;this.credentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=zi.UNAUTHENTICATED,this.clientId=_.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(n,function(t){return(0,e.__awaiter)(i,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return f(\"FirestoreClient\",\"Received user=\",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}})})})}return t.prototype.getConfiguration=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new u(a.FAILED_PRECONDITION,\"The client has already been terminated.\")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var n=new er;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return(0,e.__awaiter)(t,void 0,void 0,function(){var t,r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:e.sent(),e.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:e.sent(),e.label=4;case 4:return this.credentials.removeChangeListener(),n.resolve(),[3,6];case 5:return t=e.sent(),r=Go(t,\"Failed to shutdown persistence\"),n.reject(r),[3,6];case 6:return[2]}})})}),n.promise},t}();function ea(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o=this;return(0,e.__generator)(this,function(s){switch(s.label){case 0:return t.asyncQueue.verifyOperationInProgress(),f(\"FirestoreClient\",\"Initializing OfflineComponentProvider\"),[4,t.getConfiguration()];case 1:return r=s.sent(),[4,n.initialize(r)];case 2:return s.sent(),i=r.initialUser,t.setCredentialChangeListener(function(t){return(0,e.__awaiter)(o,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return i.isEqual(t)?[3,2]:[4,Ii(n.localStore,t)];case 1:e.sent(),i=t,e.label=2;case 2:return[2]}})})}),n.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=n,[2]}})})}function na(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i;return(0,e.__generator)(this,function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,ra(t)];case 1:return r=o.sent(),f(\"FirestoreClient\",\"Initializing OnlineComponentProvider\"),[4,t.getConfiguration()];case 2:return i=o.sent(),[4,n.initialize(r,i)];case 3:return o.sent(),t.setCredentialChangeListener(function(t){return function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return(r=m(t)).asyncQueue.verifyOperationInProgress(),f(\"RemoteStore\",\"RemoteStore received new credentials\"),i=Do(r),r.Or.add(3),[4,wo(r)];case 1:return e.sent(),i&&r.Br.set(\"Unknown\"),[4,r.remoteSyncer.handleCredentialChange(n)];case 2:return e.sent(),r.Or.delete(3),[4,_o(r)];case 3:return e.sent(),[2]}})})}(n.remoteStore,t)}),t.onlineComponents=n,[2]}})})}function ra(t){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(f(\"FirestoreClient\",\"Using default OfflineComponentProvider\"),[4,ea(t,new Gs)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function ia(t){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(f(\"FirestoreClient\",\"Using default OnlineComponentProvider\"),[4,na(t,new Hs)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function oa(t){return ra(t).then(function(t){return t.persistence})}function sa(t){return ra(t).then(function(t){return t.localStore})}function aa(t){return ia(t).then(function(t){return t.remoteStore})}function ua(t){return ia(t).then(function(t){return t.syncEngine})}function ca(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n,r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,ia(t)];case 1:return n=e.sent(),[2,((r=n.eventManager).onListen=ds.bind(null,n.syncEngine),r.onUnlisten=ys.bind(null,n.syncEngine),r)]}})})}function ha(t,n,r){var i=this;void 0===r&&(r={});var o=new er;return t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(i,void 0,void 0,function(){var i;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return i=function(t,e,n,r,i){var o=new $s({next:function(o){e.enqueueAndForget(function(){return Jo(t,s)});var c=o.docs.has(n);!c&&o.fromCache?i.reject(new u(a.UNAVAILABLE,\"Failed to get document because the client is offline.\")):c&&o.fromCache&&r&&\"server\"===r.source?i.reject(new u(a.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to \"server\" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new ns(kt(n.path),o,{includeMetadataChanges:!0,so:!0});return Xo(t,s)},[4,ca(t)];case 1:return[2,i.apply(void 0,[e.sent(),t.asyncQueue,n,r,o])]}})})}),o.promise}function fa(t,n,r){var i=this;void 0===r&&(r={});var o=new er;return t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(i,void 0,void 0,function(){var i;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return i=function(t,e,n,r,i){var o=new $s({next:function(n){e.enqueueAndForget(function(){return Jo(t,s)}),n.fromCache&&\"server\"===r.source?i.reject(new u(a.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to \"server\" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new ns(n,o,{includeMetadataChanges:!0,so:!0});return Xo(t,s)},[4,ca(t)];case 1:return[2,i.apply(void 0,[e.sent(),t.asyncQueue,n,r,o])]}})})}),o.promise}var la=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},da=function(){function t(t,e){this.projectId=t,this.database=e||\"(default)\"}return Object.defineProperty(t.prototype,\"isDefaultDatabase\",{get:function(){return\"(default)\"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),pa=new Map,ya=function(t,e){this.user=e,this.type=\"OAuth\",this.authHeaders={},this.authHeaders.Authorization=\"Bearer \"+t},va=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable(function(){return e(zi.UNAUTHENTICATED)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),ma=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable(function(){return e(n.token.user)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),ga=function(){function t(t){var e=this;this.currentUser=zi.UNAUTHENTICATED,this.oc=new er,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable(function(){return e.changeListener(e.currentUser)})};var n=function(t){f(\"FirebaseCredentialsProvider\",\"Auth detected\"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit(function(t){return n(t)}),setTimeout(function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(f(\"FirebaseCredentialsProvider\",\"Auth not yet detected\"),e.oc.resolve())}},0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.cc!==e?(f(\"FirebaseCredentialsProvider\",\"getToken aborted due to token change.\"),t.getToken()):n?(v(\"string\"==typeof n.accessToken),new ya(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,n){var r=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return(0,e.__awaiter)(r,void 0,void 0,function(){return(0,e.__generator)(this,function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,n(this.currentUser)];case 2:return t.sent(),this.changeListener=n,[2]}})})})},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return v(null===t||\"string\"==typeof t),new zi(t)},t}(),_a=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type=\"FirstParty\",this.user=zi.FIRST_PARTY}return Object.defineProperty(t.prototype,\"authHeaders\",{get:function(){var t={\"X-Goog-AuthUser\":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t[\"X-Goog-Iam-Authorization-Token\"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),wa=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new _a(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable(function(){return e(zi.FIRST_PARTY)})},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function ba(t,e,n){if(!n)throw new u(a.INVALID_ARGUMENT,\"Function \"+t+\"() cannot be called with an empty \"+e+\".\")}function Ia(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new u(a.INVALID_ARGUMENT,\"Invalid options passed to function \"+t+'(): You cannot specify both \"merge\" and \"mergeFields\".');return e}function Ea(t,e,n,r){if(!0===e&&!0===r)throw new u(a.INVALID_ARGUMENT,t+\" and \"+n+\" cannot be used together.\")}function Ta(t){if(!Q.isDocumentKey(t))throw new u(a.INVALID_ARGUMENT,\"Invalid document reference. Document references must have an even number of segments, but \"+t+\" has \"+t.length+\".\")}function Sa(t){if(Q.isDocumentKey(t))throw new u(a.INVALID_ARGUMENT,\"Invalid collection reference. Collection references must have an odd number of segments, but \"+t+\" has \"+t.length+\".\")}function Na(t){if(void 0===t)return\"undefined\";if(null===t)return\"null\";if(\"string\"==typeof t)return t.length>20&&(t=t.substring(0,20)+\"...\"),JSON.stringify(t);if(\"number\"==typeof t||\"boolean\"==typeof t)return\"\"+t;if(\"object\"==o(t)){if(t instanceof Array)return\"an array\";var e=function(t){if(t.constructor){var e=/function\\s+([^\\s(]+)\\s*\\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?\"a custom \"+e+\" object\":\"an object\"}return\"function\"==typeof t?\"a function\":y()}function Da(t,e){if(\"_delegate\"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new u(a.INVALID_ARGUMENT,\"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?\");var n=Na(t);throw new u(a.INVALID_ARGUMENT,\"Expected type '\"+e.name+\"', but it was: \"+n)}return t}function Aa(t,e){if(e<=0)throw new u(a.INVALID_ARGUMENT,\"Function \"+t+\"() requires a positive number, but it was: \"+e+\".\")}var xa=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new u(a.INVALID_ARGUMENT,\"Can't provide ssl option if host option is not set\");this.host=\"firestore.googleapis.com\",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new u(a.INVALID_ARGUMENT,\"cacheSizeBytes must be at least 1048576\");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Ea(\"experimentalForceLongPolling\",t.experimentalForceLongPolling,\"experimentalAutoDetectLongPolling\",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),ka=function(){function t(t,e){this.type=\"firestore-lite\",this._persistenceKey=\"(lite)\",this._settings=new xa({}),this._settingsFrozen=!1,t instanceof da?(this._databaseId=t,this._credentials=new va):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,[\"projectId\"]))throw new u(a.INVALID_ARGUMENT,'\"projectId\" not provided in firebase.initializeApp.');return new da(t.options.projectId)}(t),this._credentials=new ga(e))}return Object.defineProperty(t.prototype,\"app\",{get:function(){if(!this._app)throw new u(a.FAILED_PRECONDITION,\"Firestore was not initialized using the Firebase SDK. 'app' is not available\");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"_initialized\",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"_terminated\",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new u(a.FAILED_PRECONDITION,\"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.\");this._settings=new xa(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new va;switch(t.type){case\"gapi\":var e=t.client;return v(!(\"object\"!=o(e)||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new wa(e,t.sessionIndex||\"0\",t.iamToken||null);case\"provider\":return t.client;default:throw new u(a.INVALID_ARGUMENT,\"makeCredentialsProvider failed due to invalid credential type\")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return this,(t=pa.get(this))&&(f(\"ComponentProvider\",\"Removing Datastore\"),pa.delete(this),t.terminate()),Promise.resolve();var t},t}(),Ca=function(){function t(t,e,n){this.converter=e,this._key=n,this.type=\"document\",this.firestore=t}return Object.defineProperty(t.prototype,\"_path\",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"id\",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"path\",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"parent\",{get:function(){return new La(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),Ra=function(){function t(t,e,n){this.converter=e,this._query=n,this.type=\"query\",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),La=function(t){function n(e,n,r){var i=this;return(i=t.call(this,e,n,kt(r))||this)._path=r,i.type=\"collection\",i}return(0,e.__extends)(n,t),Object.defineProperty(n.prototype,\"id\",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,\"path\",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,\"parent\",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Ca(this.firestore,null,new Q(t))},enumerable:!1,configurable:!0}),n.prototype.withConverter=function(t){return new n(this.firestore,t,this._path)},n}(Ra);function Oa(t,r){for(var i,o=[],s=2;s<arguments.length;s++)o[s-2]=arguments[s];if(t=(0,n.getModularInstance)(t),ba(\"collection\",\"path\",r),t instanceof ka)return Sa(i=x.fromString.apply(x,(0,e.__spreadArray)([r],o))),new La(t,null,i);if(!(t instanceof Ca||t instanceof La))throw new u(a.INVALID_ARGUMENT,\"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore\");return Sa(i=x.fromString.apply(x,(0,e.__spreadArray)([t.path],o)).child(x.fromString(r))),new La(t.firestore,null,i)}function Pa(t,r){for(var i,o=[],s=2;s<arguments.length;s++)o[s-2]=arguments[s];if(t=(0,n.getModularInstance)(t),1===arguments.length&&(r=_.u()),ba(\"doc\",\"path\",r),t instanceof ka)return Ta(i=x.fromString.apply(x,(0,e.__spreadArray)([r],o))),new Ca(t,null,new Q(i));if(!(t instanceof Ca||t instanceof La))throw new u(a.INVALID_ARGUMENT,\"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore\");return Ta(i=t._path.child(x.fromString.apply(x,(0,e.__spreadArray)([r],o)))),new Ca(t.firestore,t instanceof La?t.converter:null,new Q(i))}function Ma(t,e){return t=(0,n.getModularInstance)(t),e=(0,n.getModularInstance)(e),(t instanceof Ca||t instanceof La)&&(e instanceof Ca||e instanceof La)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Fa(t,e){return t=(0,n.getModularInstance)(t),e=(0,n.getModularInstance)(e),t instanceof Ra&&e instanceof Ra&&t.firestore===e.firestore&&qt(t._query,e._query)&&t.converter===e.converter}var Va=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=[],this.Zi=new fo(this,\"async_queue_retry\"),this.Tc=function(){var e=co();e&&f(\"AsyncQueue\",\"Visibility state changed to \"+e.visibilityState),t.Zi.Gi()};var e=co();e&&\"function\"==typeof e.addEventListener&&e.addEventListener(\"visibilitychange\",this.Tc)}return Object.defineProperty(t.prototype,\"isShuttingDown\",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ic(),this.Ac(t)},t.prototype.enterRestrictedMode=function(){if(!this._c){this._c=!0;var t=co();t&&\"function\"==typeof t.removeEventListener&&t.removeEventListener(\"visibilitychange\",this.Tc)}},t.prototype.enqueue=function(t){return this.Ic(),this._c?new Promise(function(t){}):this.Ac(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.wc.push(t),e.Rc()})},t.prototype.Rc=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t,n=this;return(0,e.__generator)(this,function(e){switch(e.label){case 0:if(0===this.wc.length)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return e.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!ar(t=e.sent()))throw t;return f(\"AsyncQueue\",\"Operation failed with retryable error: \"+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return n.Rc()}),e.label=5;case 5:return[2]}})})},t.prototype.Ac=function(t){var e=this,n=this.dc.then(function(){return e.gc=!0,t().catch(function(t){throw e.yc=t,e.gc=!1,l(\"INTERNAL UNHANDLED ERROR: \",function(t){var e=t.message||\"\";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+\"\\n\"+t.stack),e}(t)),t}).then(function(t){return e.gc=!1,t})});return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ic(),this.Ec.indexOf(t)>-1&&(e=0);var i=Qo.createAndSchedule(this,t,e,n,function(t){return r.bc(t)});return this.mc.push(i),i},t.prototype.Ic=function(){this.yc&&y()},t.prototype.verifyOperationInProgress=function(){},t.prototype.vc=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.Pc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Vc=function(t){var e=this;return this.vc().then(function(){e.mc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),\"all\"!==t&&i.timerId===t)break}return e.vc()})},t.prototype.Sc=function(t){this.Ec.push(t)},t.prototype.bc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function qa(t){return function(t,e){if(\"object\"!=o(t)||null===t)return!1;for(var n=t,r=0,i=[\"next\",\"error\",\"complete\"];r<i.length;r++){var s=i[r];if(s in n&&\"function\"==typeof n[s])return!0}return!1}(t)}var Ua=function(){function t(){this._progressObserver={},this._taskCompletionResolver=new er,this._lastProgress={taskState:\"Running\",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}return t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState=\"Error\",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)},t}(),Ba=-1,ja=function(t){function n(e,n){var r=this;return(r=t.call(this,e,n)||this).type=\"firestore\",r._queue=new Va,r._persistenceKey=\"name\"in e?e.name:\"[DEFAULT]\",r}return(0,e.__extends)(n,t),n.prototype._terminate=function(){return this._firestoreClient||Qa(this),this._firestoreClient.terminate()},n}(ka);function Ka(t){return t._firestoreClient||Qa(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Qa(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new la(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||\"\",t._persistenceKey,n);t._firestoreClient=new ta(t._credentials,t._queue,r)}function Ga(t,n,r){var i=this,o=new er;return t.asyncQueue.enqueue(function(){return(0,e.__awaiter)(i,void 0,void 0,function(){var i;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,ea(t,r)];case 1:return e.sent(),[4,na(t,n)];case 2:return e.sent(),o.resolve(),[3,4];case 3:if(!function(t){return\"FirebaseError\"===t.name?t.code===a.FAILED_PRECONDITION||t.code===a.UNIMPLEMENTED:!(\"undefined\"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(i=e.sent()))throw i;return console.warn(\"Error enabling offline persistence. Falling back to persistence disabled: \"+i),o.reject(i),[3,4];case 4:return[2]}})})}).then(function(){return o.promise})}function za(t){if(t._initialized||t._terminated)throw new u(a.FAILED_PRECONDITION,\"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.\")}exports.E=ja,exports.p=Ba;var Wa=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new u(a.INVALID_ARGUMENT,\"Invalid field name at argument $(i + 1). Field names must not be empty.\");this._internalPath=new C(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),Ha=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(L.fromBase64String(e))}catch(e){throw new u(a.INVALID_ARGUMENT,\"Failed to construct data from Base64 string: \"+e)}},t.fromUint8Array=function(e){return new t(L.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return\"Bytes(base64: \"+this.toBase64()+\")\"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),Ya=function(t){this._methodName=t},$a=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new u(a.INVALID_ARGUMENT,\"Latitude must be a number between -90 and 90, but was: \"+t);if(!isFinite(e)||e<-180||e>180)throw new u(a.INVALID_ARGUMENT,\"Longitude must be a number between -180 and 180, but was: \"+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,\"latitude\",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"longitude\",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return w(this._lat,t._lat)||w(this._long,t._long)},t}(),Xa=/^__.*__$/,Ja=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new me(t,this.data,this.fieldMask,e,this.fieldTransforms):new ve(t,this.data,e,this.fieldTransforms)},t}(),Za=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new me(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function tu(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw y()}}exports.D=$a;var eu=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Dc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,\"path\",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"Cc\",{get:function(){return this.settings.Cc},enumerable:!1,configurable:!0}),t.prototype.Nc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.xc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Nc({path:n,Fc:!1});return r.kc(t),r},t.prototype.$c=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Nc({path:n,Fc:!1});return r.Dc(),r},t.prototype.Oc=function(t){return this.Nc({path:void 0,Fc:!0})},t.prototype.Mc=function(t){return bu(t,this.settings.methodName,this.settings.Lc||!1,this.path,this.settings.Bc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.Dc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.kc(this.path.get(t))},t.prototype.kc=function(t){if(0===t.length)throw this.Mc(\"Document fields must not be empty\");if(tu(this.Cc)&&Xa.test(t))throw this.Mc('Document fields cannot begin and end with \"__\"')},t}(),nu=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||ho(t)}return t.prototype.qc=function(t,e,n,r){return void 0===r&&(r=!1),new eu({Cc:t,methodName:e,Bc:n,path:C.emptyPath(),Fc:!1,Lc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function ru(t){var e=t._freezeSettings(),n=ho(t._databaseId);return new nu(t._databaseId,!!e.ignoreUndefinedProperties,n)}function iu(t,e,n,r,i,o){void 0===o&&(o={});var s=t.qc(o.merge||o.mergeFields?2:0,e,n,i);mu(\"Data must be an object, but it was:\",s,r);var c,h,f=yu(r,s);if(o.merge)c=new R(s.fieldMask),h=s.fieldTransforms;else if(o.mergeFields){for(var l=[],d=0,p=o.mergeFields;d<p.length;d++){var y=gu(e,p[d],n);if(!s.contains(y))throw new u(a.INVALID_ARGUMENT,\"Field '\"+y+\"' is specified in your field mask but missing from your input data.\");Iu(l,y)||l.push(y)}c=new R(l),h=s.fieldTransforms.filter(function(t){return c.covers(t.field)})}else c=null,h=s.fieldTransforms;return new Ja(new ot(f),c,h)}var ou=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n.prototype._toFieldTransform=function(t){if(2!==t.Cc)throw 1===t.Cc?t.Mc(this._methodName+\"() can only appear at the top level of your update data\"):t.Mc(this._methodName+\"() cannot be used with set() unless you pass {merge:true}\");return t.fieldMask.push(t.path),null},n.prototype.isEqual=function(t){return t instanceof n},n}(Ya);function su(t,e,n){return new eu({Cc:3,Bc:e.settings.Bc,methodName:t._methodName,Fc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var au=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n.prototype._toFieldTransform=function(t){return new se(t.path,new Jt)},n.prototype.isEqual=function(t){return t instanceof n},n}(Ya),uu=function(t){function n(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return(0,e.__extends)(n,t),n.prototype._toFieldTransform=function(t){var e=su(this,t,!0),n=this.Uc.map(function(t){return pu(t,e)}),r=new Zt(n);return new se(t.path,r)},n.prototype.isEqual=function(t){return this===t},n}(Ya),cu=function(t){function n(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return(0,e.__extends)(n,t),n.prototype._toFieldTransform=function(t){var e=su(this,t,!0),n=this.Uc.map(function(t){return pu(t,e)}),r=new ee(n);return new se(t.path,r)},n.prototype.isEqual=function(t){return this===t},n}(Ya),hu=function(t){function n(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return(0,e.__extends)(n,t),n.prototype._toFieldTransform=function(t){var e=new re(t.R,Wt(t.R,this.Kc));return new se(t.path,e)},n.prototype.isEqual=function(t){return this===t},n}(Ya);function fu(t,e,r,i){var o=t.qc(1,e,r);mu(\"Data must be an object, but it was:\",o,i);var s=[],a=ot.empty();N(i,function(t,i){var u=wu(e,t,r);i=(0,n.getModularInstance)(i);var c=o.$c(u);if(i instanceof ou)s.push(u);else{var h=pu(i,c);null!=h&&(s.push(u),a.set(u,h))}});var u=new R(s);return new Za(a,u,o.fieldTransforms)}function lu(t,e,r,i,o,s){var c=t.qc(1,e,r),h=[gu(e,i,r)],f=[o];if(s.length%2!=0)throw new u(a.INVALID_ARGUMENT,\"Function \"+e+\"() needs to be called with an even number of arguments that alternate between field names and values.\");for(var l=0;l<s.length;l+=2)h.push(gu(e,s[l])),f.push(s[l+1]);for(var d=[],p=ot.empty(),y=h.length-1;y>=0;--y)if(!Iu(d,h[y])){var v=h[y],m=f[y];m=(0,n.getModularInstance)(m);var g=c.$c(v);if(m instanceof ou)d.push(v);else{var _=pu(m,g);null!=_&&(d.push(v),p.set(v,_))}}var w=new R(d);return new Za(p,w,c.fieldTransforms)}function du(t,e,n,r){return void 0===r&&(r=!1),pu(n,t.qc(r?4:3,e))}function pu(t,e){if(vu(t=(0,n.getModularInstance)(t)))return mu(\"Unsupported field value:\",e,t),yu(t,e);if(t instanceof Ya)return function(t,e){if(!tu(e.Cc))throw e.Mc(t._methodName+\"() can only be used with update() and set()\");if(!e.path)throw e.Mc(t._methodName+\"() is not currently supported inside arrays\");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&4!==e.Cc)throw e.Mc(\"Nested arrays are not supported\");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=pu(o[i],e.Oc(r));null==s&&(s={nullValue:\"NULL_VALUE\"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,n.getModularInstance)(t)))return{nullValue:\"NULL_VALUE\"};if(\"number\"==typeof t)return Wt(e.R,t);if(\"boolean\"==typeof t)return{booleanValue:t};if(\"string\"==typeof t)return{stringValue:t};if(t instanceof Date){var r=E.fromDate(t);return{timestampValue:en(e.R,r)}}if(t instanceof E)return r=new E(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:en(e.R,r)};if(t instanceof $a)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Ha)return{bytesValue:nn(e.R,t._byteString)};if(t instanceof Ca){r=e.databaseId;var i=t.firestore._databaseId;if(!i.isEqual(r))throw e.Mc(\"Document reference is for database \"+i.projectId+\"/\"+i.database+\" but should be for database \"+r.projectId+\"/\"+r.database);return{referenceValue:sn(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Mc(\"Unsupported field value: \"+Na(t))}(t,e)}function yu(t,e){var n={};return D(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):N(t,function(t,r){var i=pu(r,e.xc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function vu(t){return!(\"object\"!=o(t)||null===t||t instanceof Array||t instanceof Date||t instanceof E||t instanceof $a||t instanceof Ha||t instanceof Ca||t instanceof Ya)}function mu(t,e,n){if(!vu(n)||!function(t){return\"object\"==o(t)&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=Na(n);throw\"an object\"===r?e.Mc(t+\" a custom object\"):e.Mc(t+\" \"+r)}}function gu(t,e,r){if((e=(0,n.getModularInstance)(e))instanceof Wa)return e._internalPath;if(\"string\"==typeof e)return wu(t,e);throw bu(\"Field path arguments must be of type string or FieldPath.\",t,!1,void 0,r)}var _u=new RegExp(\"[~\\\\*/\\\\[\\\\]]\");function wu(t,n,r){if(n.search(_u)>=0)throw bu(\"Invalid field path (\"+n+\"). Paths must not contain '~', '*', '/', '[', or ']'\",t,!1,void 0,r);try{return(new(Wa.bind.apply(Wa,(0,e.__spreadArray)([void 0],n.split(\".\")))))._internalPath}catch(i){throw bu(\"Invalid field path (\"+n+\"). Paths must not be empty, begin with '.', end with '.', or contain '..'\",t,!1,void 0,r)}}function bu(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,c=\"Function \"+e+\"() called with invalid data\";n&&(c+=\" (via `toFirestore()`)\");var h=\"\";return(o||s)&&(h+=\" (found\",o&&(h+=\" in field \"+r),s&&(h+=\" in document \"+i),h+=\")\"),new u(a.INVALID_ARGUMENT,(c+=\". \")+t+h)}function Iu(t,e){return t.some(function(t){return t.isEqual(e)})}var Eu=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,\"id\",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"ref\",{get:function(){return new Ca(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new Tu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(Su(\"DocumentSnapshot.get\",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),Tu=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n.prototype.data=function(){return t.prototype.data.call(this)},n}(Eu);function Su(t,e){return\"string\"==typeof e?wu(t,e):e instanceof Wa?e._internalPath:e._delegate._internalPath}var Nu=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Du=function(t){function n(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return(0,e.__extends)(n,t),n.prototype.exists=function(){return t.prototype.exists.call(this)},n.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Au(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},n.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(Su(\"DocumentSnapshot.get\",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},n}(Eu),Au=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},n}(Du),xu=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Nu(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,\"docs\",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"size\",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"empty\",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new Au(n._firestore,n._userDataWriter,r.key,r,new Nu(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new u(a.INVALID_ARGUMENT,\"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().\");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){return{type:\"added\",doc:new Au(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Nu(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new Au(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Nu(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:ku(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function ku(t){switch(t){case 0:return\"added\";case 2:case 3:return\"modified\";case 1:return\"removed\";default:return y()}}function Cu(t,e){return t instanceof Du&&e instanceof Du?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof xu&&e instanceof xu&&t._firestore===e._firestore&&Fa(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Ru(t){if(Rt(t)&&0===t.explicitOrderBy.length)throw new u(a.UNIMPLEMENTED,\"limitToLast() queries require specifying at least one orderBy() clause\")}var Lu=function(){};function Ou(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){t=i[r]._apply(t)}return t}var Pu=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).Qc=e,i.jc=n,i.Wc=r,i.type=\"where\",i}return(0,e.__extends)(n,t),n.prototype._apply=function(t){var e=ru(t.firestore),n=function(t,e,n,r,i,o,s){var c;if(i.isKeyField()){if(\"array-contains\"===o||\"array-contains-any\"===o)throw new u(a.INVALID_ARGUMENT,\"Invalid Query. You can't perform '\"+o+\"' queries on FieldPath.documentId().\");if(\"in\"===o||\"not-in\"===o){ju(s,o);for(var h=[],f=0,l=s;f<l.length;f++){var d=l[f];h.push(Bu(r,t,d))}c={arrayValue:{values:h}}}else c=Bu(r,t,s)}else\"in\"!==o&&\"not-in\"!==o&&\"array-contains-any\"!==o||ju(s,o),c=du(n,\"where\",s,\"in\"===o||\"not-in\"===o);var p=dt.create(i,o,c);return function(t,e){if(e.g()){var n=Ot(t);if(null!==n&&!n.isEqual(e.field))throw new u(a.INVALID_ARGUMENT,\"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '\"+n.toString()+\"' and '\"+e.field.toString()+\"'\");var r=Lt(t);null!==r&&Ku(t,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(e.op){case\"!=\":return[\"!=\",\"not-in\"];case\"array-contains\":return[\"array-contains\",\"array-contains-any\",\"not-in\"];case\"in\":return[\"array-contains-any\",\"in\",\"not-in\"];case\"array-contains-any\":return[\"array-contains\",\"array-contains-any\",\"in\",\"not-in\"];case\"not-in\":return[\"array-contains\",\"array-contains-any\",\"in\",\"not-in\",\"!=\"];default:return[]}}());if(null!==i)throw i===e.op?new u(a.INVALID_ARGUMENT,\"Invalid query. You cannot use more than one '\"+e.op.toString()+\"' filter.\"):new u(a.INVALID_ARGUMENT,\"Invalid query. You cannot use '\"+e.op.toString()+\"' filters with '\"+i.toString()+\"' filters.\")}(t,p),p}(t._query,0,e,t.firestore._databaseId,this.Qc,this.jc,this.Wc);return new Ra(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new At(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},n}(Lu),Mu=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).Qc=e,r.Gc=n,r.type=\"orderBy\",r}return(0,e.__extends)(n,t),n.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new u(a.INVALID_ARGUMENT,\"Invalid query. You must not call startAt() or startAfter() before calling orderBy().\");if(null!==t.endAt)throw new u(a.INVALID_ARGUMENT,\"Invalid query. You must not call endAt() or endBefore() before calling orderBy().\");var r=new Tt(e,n);return function(t,e){if(null===Lt(t)){var n=Ot(t);null!==n&&Ku(t,n,e.field)}}(t,r),r}(t._query,this.Qc,this.Gc);return new Ra(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new At(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},n}(Lu),Fu=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.zc=n,i.Hc=r,i}return(0,e.__extends)(n,t),n.prototype._apply=function(t){return new Ra(t.firestore,t.converter,Vt(t._query,this.zc,this.Hc))},n}(Lu),Vu=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Jc=n,i.Yc=r,i}return(0,e.__extends)(n,t),n.prototype._apply=function(t){var e=Uu(t,this.type,this.Jc,this.Yc);return new Ra(t.firestore,t.converter,function(t,e){return new At(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},n}(Lu),qu=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Jc=n,i.Yc=r,i}return(0,e.__extends)(n,t),n.prototype._apply=function(t){var e=Uu(t,this.type,this.Jc,this.Yc);return new Ra(t.firestore,t.converter,function(t,e){return new At(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},n}(Lu);function Uu(t,e,r,i){if(r[0]=(0,n.getModularInstance)(r[0]),r[0]instanceof Eu)return function(t,e,n,r,i){if(!r)throw new u(a.NOT_FOUND,\"Can't use a DocumentSnapshot that doesn't exist for \"+n+\"().\");for(var o=[],s=0,c=Mt(t);s<c.length;s++){var h=c[s];if(h.field.isKeyField())o.push(J(e,r.key));else{var f=r.data.field(h.field);if(V(f))throw new u(a.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field \"'+h.field+'\" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===f){var l=h.field.canonicalString();throw new u(a.INVALID_ARGUMENT,\"Invalid query. You are trying to start or end a query using a document for which the field '\"+l+\"' (used as the orderBy) does not exist.\")}o.push(f)}}return new It(o,i)}(t._query,t.firestore._databaseId,e,r[0]._document,i);var s=ru(t.firestore);return function(t,e,n,r,i,s){var c=t.explicitOrderBy;if(i.length>c.length)throw new u(a.INVALID_ARGUMENT,\"Too many arguments provided to \"+r+\"(). The number of arguments must be less than or equal to the number of orderBy() clauses\");for(var h=[],f=0;f<i.length;f++){var l=i[f];if(c[f].field.isKeyField()){if(\"string\"!=typeof l)throw new u(a.INVALID_ARGUMENT,\"Invalid query. Expected a string for document ID in \"+r+\"(), but got a \"+o(l));if(!Pt(t)&&-1!==l.indexOf(\"/\"))throw new u(a.INVALID_ARGUMENT,\"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to \"+r+\"() must be a plain document ID, but '\"+l+\"' contains a slash.\");var d=t.path.child(x.fromString(l));if(!Q.isDocumentKey(d))throw new u(a.INVALID_ARGUMENT,\"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to \"+r+\"() must result in a valid document path, but '\"+d+\"' is not because it contains an odd number of segments.\");var p=new Q(d);h.push(J(e,p))}else{var y=du(n,r,l);h.push(y)}}return new It(h,s)}(t._query,t.firestore._databaseId,s,e,r,i)}function Bu(t,e,r){if(\"string\"==typeof(r=(0,n.getModularInstance)(r))){if(\"\"===r)throw new u(a.INVALID_ARGUMENT,\"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.\");if(!Pt(e)&&-1!==r.indexOf(\"/\"))throw new u(a.INVALID_ARGUMENT,\"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '\"+r+\"' contains a '/' character.\");var i=e.path.child(x.fromString(r));if(!Q.isDocumentKey(i))throw new u(a.INVALID_ARGUMENT,\"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '\"+i+\"' is not because it has an odd number of segments (\"+i.length+\").\");return J(t,new Q(i))}if(r instanceof Ca)return J(t,r._key);throw new u(a.INVALID_ARGUMENT,\"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: \"+Na(r)+\".\")}function ju(t,e){if(!Array.isArray(t)||0===t.length)throw new u(a.INVALID_ARGUMENT,\"Invalid Query. A non-empty array is required for '\"+e.toString()+\"' filters.\");if(t.length>10)throw new u(a.INVALID_ARGUMENT,\"Invalid Query. '\"+e.toString()+\"' filters support a maximum of 10 elements in the value array.\")}function Ku(t,e,n){if(!n.isEqual(e))throw new u(a.INVALID_ARGUMENT,\"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '\"+e.toString()+\"' and so you must also use '\"+e.toString()+\"' as your first argument to orderBy(), but your first orderBy() is on field '\"+n.toString()+\"' instead.\")}var Qu=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e=\"none\"),G(t)){case 0:return null;case 1:return t.booleanValue;case 2:return M(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(F(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw y()}},t.prototype.convertObject=function(t,e){var n=this,r={};return N(t.fields,function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertGeoPoint=function(t){return new $a(M(t.latitude),M(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},t.prototype.convertServerTimestamp=function(t,e){switch(e){case\"previous\":var n=q(t);return null==n?null:this.convertValue(n,e);case\"estimate\":return this.convertTimestamp(U(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=P(t);return new E(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=x.fromString(t);v(Cn(n));var r=new da(n.get(1),n.get(3)),i=new Q(n.popFirst(5));return r.isEqual(e)||l(\"Document \"+i+\" contains a document reference within a different database (\"+r.projectId+\"/\"+r.database+\") which is not supported. It will be treated as a reference in the current database (\"+e.projectId+\"/\"+e.database+\") instead.\"),i},t}();function Gu(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var zu=function(t){function n(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,e.__extends)(n,t),n.prototype.convertBytes=function(t){return new Ha(t)},n.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Ca(this.firestore,null,e)},n}(Qu),Wu=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=ru(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=Hu(t,this._firestore),i=Gu(r.converter,e,n),o=iu(this._dataReader,\"WriteBatch.set\",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,ue.none())),this},t.prototype.update=function(t,e,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];this._verifyNotCommitted();var s,a=Hu(t,this._firestore);return s=\"string\"==typeof(e=(0,n.getModularInstance)(e))||e instanceof Wa?lu(this._dataReader,\"WriteBatch.update\",a._key,e,r,i):fu(this._dataReader,\"WriteBatch.update\",a._key,e),this._mutations.push(s.toMutation(a._key,ue.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=Hu(t,this._firestore);return this._mutations=this._mutations.concat(new Ee(e._key,ue.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new u(a.FAILED_PRECONDITION,\"A write batch can no longer be used after commit() has been called.\")},t}();function Hu(t,e){if((t=(0,n.getModularInstance)(t)).firestore!==e)throw new u(a.INVALID_ARGUMENT,\"Provided document reference is from a different Firestore instance.\");return t}var Yu=function(t){function n(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,e.__extends)(n,t),n.prototype.convertBytes=function(t){return new Ha(t)},n.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Ca(this.firestore,null,e)},n}(Qu);function $u(t,e,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];t=Da(t,Ca);var s=Da(t.firestore,ja),a=ru(s);return Ju(s,[(\"string\"==typeof(e=(0,n.getModularInstance)(e))||e instanceof Wa?lu(a,\"updateDoc\",t._key,e,r,i):fu(a,\"updateDoc\",t._key,e)).toMutation(t._key,ue.exists(!0))])}function Xu(t){for(var r,i,s,a=[],u=1;u<arguments.length;u++)a[u-1]=arguments[u];t=(0,n.getModularInstance)(t);var c={includeMetadataChanges:!1},h=0;\"object\"!=o(a[h])||qa(a[h])||(c=a[h],h++);var f,l,d,p={includeMetadataChanges:c.includeMetadataChanges};if(qa(a[h])){var y=a[h];a[h]=null===(r=y.next)||void 0===r?void 0:r.bind(y),a[h+1]=null===(i=y.error)||void 0===i?void 0:i.bind(y),a[h+2]=null===(s=y.complete)||void 0===s?void 0:s.bind(y)}if(t instanceof Ca)l=Da(t.firestore,ja),d=kt(t._key.path),f={next:function(e){a[h]&&a[h](Zu(l,t,e))},error:a[h+1],complete:a[h+2]};else{var v=Da(t,Ra);l=Da(v.firestore,ja),d=v._query;var m=new Yu(l);f={next:function(t){a[h]&&a[h](new xu(l,m,v,t))},error:a[h+1],complete:a[h+2]},Ru(t._query)}return function(t,n,r,i){var o=this,s=new $s(f),a=new ns(n,s,r);return t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(o,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return n=Xo,[4,ca(t)];case 1:return[2,n.apply(void 0,[e.sent(),a])]}})})}),function(){s.Wo(),t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(o,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return n=Jo,[4,ca(t)];case 1:return[2,n.apply(void 0,[e.sent(),a])]}})})})}}(Ka(l),d,p)}function Ju(t,n){return function(t,n){var r=this,i=new er;return t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(r,void 0,void 0,function(){var r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r=vs,[4,ua(t)];case 1:return[2,r.apply(void 0,[e.sent(),n,i])]}})})}),i.promise}(Ka(t),n)}function Zu(t,e,n){var r=n.docs.get(e._key),i=new Yu(t);return new Du(t,i,e._key,r,new Nu(n.hasPendingWrites,n.fromCache),e.converter)}var tc=function(t){function n(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return(0,e.__extends)(n,t),n.prototype.get=function(e){var n=this,r=Hu(e,this._firestore),i=new Yu(this._firestore);return t.prototype.get.call(this,e).then(function(t){return new Du(n._firestore,i,r._key,t._document,new Nu(!1,!1),r.converter)})},n}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=ru(t)}return t.prototype.get=function(t){var e=this,n=Hu(t,this._firestore),r=new zu(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return y();var i=t[0];if(i.isFoundDocument())return new Eu(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new Eu(e._firestore,r,n._key,null,n.converter);throw y()})},t.prototype.set=function(t,e,n){var r=Hu(t,this._firestore),i=Gu(r.converter,e,n),o=iu(this._dataReader,\"Transaction.set\",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s,a=Hu(t,this._firestore);return s=\"string\"==typeof(e=(0,n.getModularInstance)(e))||e instanceof Wa?lu(this._dataReader,\"Transaction.update\",a._key,e,r,i):fu(this._dataReader,\"Transaction.update\",a._key,e),this._transaction.update(a._key,s),this},t.prototype.delete=function(t){var e=Hu(t,this._firestore);return this._transaction.delete(e._key),this},t}());function ec(){if(\"undefined\"==typeof Uint8Array)throw new u(a.UNIMPLEMENTED,\"Uint8Arrays are not available in this environment.\")}function nc(){if(\"undefined\"==typeof atob)throw new u(a.UNIMPLEMENTED,\"Blobs are unavailable in Firestore in this environment.\")}var rc=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return nc(),new t(Ha.fromBase64String(e))},t.fromUint8Array=function(e){return ec(),new t(Ha.fromUint8Array(e))},t.prototype.toBase64=function(){return nc(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return ec(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return\"Blob(base64: \"+this.toBase64()+\")\"},t}(),ic=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){za(t=Da(t,ja));var n=Ka(t),r=t._freezeSettings(),i=new Hs;return Ga(n,i,new zs(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){za(t=Da(t,ja));var e=Ka(t),n=t._freezeSettings(),r=new Hs;return Ga(e,r,new Ws(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var n=this;if(t._initialized&&!t._terminated)throw new u(a.FAILED_PRECONDITION,\"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.\");var r=new er;return t._queue.enqueueAndForgetEvenWhileRestricted(function(){return(0,e.__awaiter)(n,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return ir.yt()?(n=t+\"main\",[4,ir.delete(n)]):[2,Promise.resolve()];case 1:return e.sent(),[2]}})})}(yi(t._databaseId,t._persistenceKey))];case 1:return i.sent(),r.resolve(),[3,3];case 2:return n=i.sent(),r.reject(n),[3,3];case 3:return[2]}})})}),r.promise}(t._delegate)},t}(),oc=function(){function t(t,e,n){var r=this;this._delegate=e,this.Xc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof da||(this.Zc=t)}return Object.defineProperty(t.prototype,\"_databaseId\",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||d(\"You are overriding the original host. If you did not intend to override your settings, use {merge: true}.\"),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,r){void 0===r&&(r={}),function(t,e,r,i){void 0===i&&(i={});var o=(t=Da(t,ka))._getSettings();if(\"firestore.googleapis.com\"!==o.host&&o.host!==e&&d(\"Host has been set in both settings() and useEmulator(), emulator host will be used\"),t._setSettings(Object.assign(Object.assign({},o),{host:e+\":\"+r,ssl:!1})),i.mockUserToken){var s=(0,n.createMockUserToken)(i.mockUserToken),c=i.mockUserToken.sub||i.mockUserToken.user_id;if(!c)throw new u(a.INVALID_ARGUMENT,\"mockUserToken must contain 'sub' or 'user_id' field!\");t._credentials=new ma(new ya(s,new zi(c)))}}(this._delegate,t,e,r)},t.prototype.enableNetwork=function(){return function(t){var n=this;return t.asyncQueue.enqueue(function(){return(0,e.__awaiter)(n,void 0,void 0,function(){var n,r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,oa(t)];case 1:return n=e.sent(),[4,aa(t)];case 2:return r=e.sent(),[2,(n.setNetworkEnabled(!0),function(t){var e=m(r);return e.Or.delete(0),_o(e)}())]}})})})}(Ka(Da(this._delegate,ja)))},t.prototype.disableNetwork=function(){return function(t){var n=this;return t.asyncQueue.enqueue(function(){return(0,e.__awaiter)(n,void 0,void 0,function(){var n,r;return(0,e.__generator)(this,function(i){switch(i.label){case 0:return[4,oa(t)];case 1:return n=i.sent(),[4,aa(t)];case 2:return r=i.sent(),[2,(n.setNetworkEnabled(!1),function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return(n=m(t)).Or.add(0),[4,wo(n)];case 1:return e.sent(),n.Br.set(\"Offline\"),[2]}})})}(r))]}})})})}(Ka(Da(this._delegate,ja)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Ea(\"synchronizeTabs\",e=!!t.synchronizeTabs,\"experimentalForceOwningTab\",n=!!t.experimentalForceOwningTab),e?this.Xc.enableMultiTabIndexedDbPersistence(this):this.Xc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Xc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.Zc&&(this.Zc._removeServiceInstance(\"firestore\"),this.Zc._removeServiceInstance(\"firestore-exp\")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var n=this,r=new er;return t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(n,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return n=Is,[4,ua(t)];case 1:return[2,n.apply(void 0,[e.sent(),r])]}})})}),r.promise}(Ka(Da(this._delegate,ja)))},t.prototype.onSnapshotsInSync=function(t){return function(t,n){return function(t,n){var r=this,i=new $s(n);return t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(r,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return n=function(t,e){m(t).Gr.add(e),e.next()},[4,ca(t)];case 1:return[2,n.apply(void 0,[e.sent(),i])]}})})}),function(){i.Wo(),t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(r,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return n=function(t,e){m(t).Gr.delete(e)},[4,ca(t)];case 1:return[2,n.apply(void 0,[e.sent(),i])]}})})})}}(Ka(t=Da(t,ja)),qa(n)?n:{next:n})}(this._delegate,t)},Object.defineProperty(t.prototype,\"app\",{get:function(){if(!this.Zc)throw new u(a.FAILED_PRECONDITION,\"Firestore was not initialized using the Firebase SDK. 'app' is not available\");return this.Zc},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new wc(this,Oa(this._delegate,t))}catch(t){throw lc(t,\"collection()\",\"Firestore.collection()\")}},t.prototype.doc=function(t){try{return new fc(this,Pa(this._delegate,t))}catch(t){throw lc(t,\"doc()\",\"Firestore.doc()\")}},t.prototype.collectionGroup=function(t){try{return new mc(this,function(t,e){if(t=Da(t,ka),ba(\"collectionGroup\",\"collection id\",e),e.indexOf(\"/\")>=0)throw new u(a.INVALID_ARGUMENT,\"Invalid collection ID '\"+e+\"' passed to function collectionGroup(). Collection IDs must not contain '/'.\");return new Ra(t,null,function(t){return new At(x.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw lc(t,\"collectionGroup()\",\"Firestore.collectionGroup()\")}},t.prototype.runTransaction=function(t){var n=this;return function(t,n){return function(t,n){var r=this,i=new er;return t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(r,void 0,void 0,function(){var r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,function(t){return ia(t).then(function(t){return t.datastore})}(t)];case 1:return r=e.sent(),new Zs(t.asyncQueue,r,n,i).run(),[2]}})})}),i.promise}(Ka(t),function(e){return n(new tc(t,e))})}(this._delegate,function(e){return t(new uc(n,e))})},t.prototype.batch=function(){var t=this;return Ka(this._delegate),new cc(new Wu(this._delegate,function(e){return Ju(t._delegate,e)}))},t.prototype.loadBundle=function(t){throw new u(a.FAILED_PRECONDITION,'\"loadBundle()\" does not exist, have you imported \"firebase/firestore/bundle\"?')},t.prototype.namedQuery=function(t){throw new u(a.FAILED_PRECONDITION,'\"namedQuery()\" does not exist, have you imported \"firebase/firestore/bundle\"?')},t}(),sc=function(t){function n(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,e.__extends)(n,t),n.prototype.convertBytes=function(t){return new rc(new Ha(t))},n.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return fc.tu(e,this.firestore,null)},n}(Qu);function ac(t){var e;e=t,c.setLogLevel(e)}exports.q=oc,exports.B=ic,exports.a=rc;var uc=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new sc(t)}return t.prototype.get=function(t){var e=this,n=bc(t);return this._delegate.get(n).then(function(t){return new yc(e._firestore,new Du(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},t.prototype.set=function(t,e,n){var r=bc(t);return n?(Ia(\"Transaction.set\",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,n,r){for(var i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var a=bc(t);return 2===arguments.length?this._delegate.update(a,n):(i=this._delegate).update.apply(i,(0,e.__spreadArray)([a,n,r],o)),this},t.prototype.delete=function(t){var e=bc(t);return this._delegate.delete(e),this},t}(),cc=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=bc(t);return n?(Ia(\"WriteBatch.set\",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,n,r){for(var i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var a=bc(t);return 2===arguments.length?this._delegate.update(a,n):(i=this._delegate).update.apply(i,(0,e.__spreadArray)([a,n,r],o)),this},t.prototype.delete=function(t){var e=bc(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),hc=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new Au(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new vc(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.eu=function(e,n){var r=t.nu,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new sc(e),n),i.set(n,o)),o},t}();exports.j=cc,exports.Q=uc,hc.nu=new WeakMap;var fc=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new sc(t)}return t.su=function(e,n,r){if(e.length%2!=0)throw new u(a.INVALID_ARGUMENT,\"Invalid document reference. Document references must have an even number of segments, but \"+e.canonicalString()+\" has \"+e.length);return new t(n,new Ca(n._delegate,r,new Q(e)))},t.tu=function(e,n,r){return new t(n,new Ca(n._delegate,r,e))},Object.defineProperty(t.prototype,\"id\",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"parent\",{get:function(){return new wc(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"path\",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new wc(this.firestore,Oa(this._delegate,t))}catch(t){throw lc(t,\"collection()\",\"DocumentReference.collection()\")}},t.prototype.isEqual=function(t){return(t=(0,n.getModularInstance)(t))instanceof Ca&&Ma(this._delegate,t)},t.prototype.set=function(t,e){e=Ia(\"DocumentReference.set\",e);try{return function(t,e,n){t=Da(t,Ca);var r=Da(t.firestore,ja),i=Gu(t.converter,e,n);return Ju(r,[iu(ru(r),\"setDoc\",t._key,i,null!==t.converter,n).toMutation(t._key,ue.none())])}(this._delegate,t,e)}catch(t){throw lc(t,\"setDoc()\",\"DocumentReference.set()\")}},t.prototype.update=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];try{return 1===arguments.length?$u(this._delegate,t):$u.apply(void 0,(0,e.__spreadArray)([this._delegate,t,n],r))}catch(t){throw lc(t,\"updateDoc()\",\"DocumentReference.update()\")}},t.prototype.delete=function(){return Ju(Da((t=this._delegate).firestore,ja),[new Ee(t._key,ue.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=dc(e),i=pc(e,function(e){return new yc(t.firestore,new Du(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))});return Xu(this._delegate,r,i)},t.prototype.get=function(t){var n=this;return(\"cache\"===(null==t?void 0:t.source)?function(t){t=Da(t,Ca);var n=Da(t.firestore,ja),r=Ka(n),i=new Yu(n);return function(t,n){var r=this,i=new er;return t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(r,void 0,void 0,function(){var r;return(0,e.__generator)(this,function(o){switch(o.label){case 0:return r=function(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,function(t,e){var n=m(t);return n.persistence.runTransaction(\"read document\",\"readonly\",function(t){return n.Mn.mn(t,e)})}(t,n)];case 1:return(o=e.sent()).isFoundDocument()?r.resolve(o):o.isNoDocument()?r.resolve(null):r.reject(new u(a.UNAVAILABLE,\"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)\")),[3,3];case 2:return i=e.sent(),o=Go(i,\"Failed to get document '\"+n+\" from cache\"),r.reject(o),[3,3];case 3:return[2]}})})},[4,sa(t)];case 1:return[2,r.apply(void 0,[o.sent(),n,i])]}})})}),i.promise}(r,t._key).then(function(e){return new Du(n,i,t._key,e,new Nu(null!==e&&e.hasLocalMutations,!0),t.converter)})}(this._delegate):\"server\"===(null==t?void 0:t.source)?function(t){t=Da(t,Ca);var e=Da(t.firestore,ja);return ha(Ka(e),t._key,{source:\"server\"}).then(function(n){return Zu(e,t,n)})}(this._delegate):function(t){t=Da(t,Ca);var e=Da(t.firestore,ja);return ha(Ka(e),t._key).then(function(n){return Zu(e,t,n)})}(this._delegate)).then(function(t){return new yc(n.firestore,new Du(n.firestore._delegate,n._userDataWriter,t._key,t._document,t.metadata,n._delegate.converter))})},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(hc.eu(this.firestore,e)):this._delegate.withConverter(null))},t}();function lc(t,e,n){return t.message=t.message.replace(e,n),t}function dc(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(\"object\"==o(r)&&!qa(r))return r}return{}}function pc(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=qa(t[0])?t[0]:qa(t[1])?t[1]:\"function\"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}exports.G=fc;var yc=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,\"ref\",{get:function(){return new fc(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"id\",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"metadata\",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"exists\",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return Cu(this._delegate,t._delegate)},t}(),vc=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n.prototype.data=function(t){return this._delegate.data(t)},n}(yc),mc=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new sc(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Ou(this._delegate,function(t,e,n){var r=e,i=Su(\"where\",t);return new Pu(i,r,n)}(e,n,r)))}catch(e){throw lc(e,/(orderBy|where)\\(\\)/,\"Query.$1()\")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Ou(this._delegate,function(t,e){void 0===e&&(e=\"asc\");var n=e,r=Su(\"orderBy\",t);return new Mu(r,n)}(e,n)))}catch(e){throw lc(e,/(orderBy|where)\\(\\)/,\"Query.$1()\")}},t.prototype.limit=function(e){try{return new t(this.firestore,Ou(this._delegate,function(t){return Aa(\"limit\",t),new Fu(\"limit\",t,\"F\")}(e)))}catch(e){throw lc(e,\"limit()\",\"Query.limit()\")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Ou(this._delegate,function(t){return Aa(\"limitToLast\",t),new Fu(\"limitToLast\",t,\"L\")}(e)))}catch(e){throw lc(e,\"limitToLast()\",\"Query.limitToLast()\")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Ou(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Vu(\"startAt\",t,!0)}.apply(void 0,e)))}catch(e){throw lc(e,\"startAt()\",\"Query.startAt()\")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Ou(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Vu(\"startAfter\",t,!1)}.apply(void 0,e)))}catch(e){throw lc(e,\"startAfter()\",\"Query.startAfter()\")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Ou(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new qu(\"endBefore\",t,!0)}.apply(void 0,e)))}catch(e){throw lc(e,\"endBefore()\",\"Query.endBefore()\")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Ou(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new qu(\"endAt\",t,!1)}.apply(void 0,e)))}catch(e){throw lc(e,\"endAt()\",\"Query.endAt()\")}},t.prototype.isEqual=function(t){return Fa(this._delegate,t._delegate)},t.prototype.get=function(t){var n=this;return(\"cache\"===(null==t?void 0:t.source)?function(t){t=Da(t,Ra);var n=Da(t.firestore,ja),r=Ka(n),i=new Yu(n);return function(t,n){var r=this,i=new er;return t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(r,void 0,void 0,function(){var r;return(0,e.__generator)(this,function(o){switch(o.label){case 0:return r=function(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s,a,u;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,ki(t,n,!0)];case 1:return u=e.sent(),i=new cs(n,u.Bn),o=i._o(u.documents),s=i.applyChanges(o,!1),r.resolve(s.snapshot),[3,3];case 2:return a=e.sent(),u=Go(a,\"Failed to execute query '\"+n+\" against cache\"),r.reject(u),[3,3];case 3:return[2]}})})},[4,sa(t)];case 1:return[2,r.apply(void 0,[o.sent(),n,i])]}})})}),i.promise}(r,t._query).then(function(e){return new xu(n,i,t,e)})}(this._delegate):\"server\"===(null==t?void 0:t.source)?function(t){t=Da(t,Ra);var e=Da(t.firestore,ja),n=Ka(e),r=new Yu(e);return fa(n,t._query,{source:\"server\"}).then(function(n){return new xu(e,r,t,n)})}(this._delegate):function(t){t=Da(t,Ra);var e=Da(t.firestore,ja),n=Ka(e),r=new Yu(e);return Ru(t._query),fa(n,t._query).then(function(n){return new xu(e,r,t,n)})}(this._delegate)).then(function(t){return new _c(n.firestore,new xu(n.firestore._delegate,n._userDataWriter,n._delegate,t._snapshot))})},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=dc(e),i=pc(e,function(e){return new _c(t.firestore,new xu(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return Xu(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(hc.eu(this.firestore,e)):this._delegate.withConverter(null))},t}(),gc=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,\"type\",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"doc\",{get:function(){return new vc(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"oldIndex\",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"newIndex\",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),_c=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,\"query\",{get:function(){return new mc(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"metadata\",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"size\",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"empty\",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"docs\",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new vc(t._firestore,e)})},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new gc(e._firestore,t)})},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach(function(r){t.call(e,new vc(n._firestore,r))})},t.prototype.isEqual=function(t){return Cu(this._delegate,t._delegate)},t}(),wc=function(t){function n(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return(0,e.__extends)(n,t),Object.defineProperty(n.prototype,\"id\",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,\"path\",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,\"parent\",{get:function(){var t=this._delegate.parent;return t?new fc(this.firestore,t):null},enumerable:!1,configurable:!0}),n.prototype.doc=function(t){try{return new fc(this.firestore,void 0===t?Pa(this._delegate):Pa(this._delegate,t))}catch(t){throw lc(t,\"doc()\",\"CollectionReference.doc()\")}},n.prototype.add=function(t){var e=this;return function(t,e){var n=Da(t.firestore,ja),r=Pa(t),i=Gu(t.converter,e);return Ju(n,[iu(ru(t.firestore),\"addDoc\",r._key,i,null!==t.converter,{}).toMutation(r._key,ue.exists(!1))]).then(function(){return r})}(this._delegate,t).then(function(t){return new fc(e.firestore,t)})},n.prototype.isEqual=function(t){return Ma(this._delegate,t._delegate)},n.prototype.withConverter=function(t){return new n(this.firestore,t?this._delegate.withConverter(hc.eu(this.firestore,t)):this._delegate.withConverter(null))},n}(mc);function bc(t){return Da(t,Ca)}exports.n=wc,exports.e=_c,exports.Z=mc,exports.X=vc,exports.Y=yc;var Ic=function(){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._delegate=new(Wa.bind.apply(Wa,(0,e.__spreadArray)([void 0],t)))}return t.documentId=function(){return new t(C.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=(0,n.getModularInstance)(t))instanceof Wa&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),Ec=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new au(\"serverTimestamp\");return e._methodName=\"FieldValue.serverTimestamp\",new t(e)},t.delete=function(){var e=new ou(\"deleteField\");return e._methodName=\"FieldValue.delete\",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new uu(\"arrayUnion\",t)}.apply(void 0,e);return r._methodName=\"FieldValue.arrayUnion\",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new cu(\"arrayRemove\",t)}.apply(void 0,e);return r._methodName=\"FieldValue.arrayRemove\",new t(r)},t.increment=function(e){var n=new hu(\"increment\",e);return n._methodName=\"FieldValue.increment\",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}();function Tc(t){return function(t,n){var r=Ka(t=Da(t,ja)),i=new Ua;return function(t,n,r,i){var o=this,s=function(t,e){return function(t,e){return new Xs(t,e)}(function(t,e){if(t instanceof Uint8Array)return Ys(t,e);if(t instanceof ArrayBuffer)return Ys(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw new Error(\"Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream\")}(\"string\"==typeof t?(new TextEncoder).encode(t):t),e)}(r,ho(n));t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(o,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return n=Qs,[4,ua(t)];case 1:return n.apply(void 0,[e.sent(),s,i]),[2]}})})})}(r,t._databaseId,n,i),i}(this._delegate,t)}function Sc(t){var n,r,i=this;return(n=this._delegate,r=t,function(t,n){var r=this;return t.asyncQueue.enqueue(function(){return(0,e.__awaiter)(r,void 0,void 0,function(){var r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r=function(t,e){var n=m(t);return n.persistence.runTransaction(\"Get named query\",\"readonly\",function(t){return n.Ke.getNamedQuery(t,e)})},[4,sa(t)];case 1:return[2,r.apply(void 0,[e.sent(),n])]}})})})}(Ka(n=Da(n,ja)),r).then(function(t){return t?new Ra(n,null,t.query):null})).then(function(t){return t?new mc(i,t):null})}exports.r=Ec,exports.i=Ic;"},"sourceMaps":null,"error":null,"hash":"95e61bb65dc78c876f21ff0674194b5a","cacheData":{"env":{}}}